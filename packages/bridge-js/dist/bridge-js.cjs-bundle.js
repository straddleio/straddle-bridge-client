var StraddleBridge=function(e){"use strict";function d(e){if(e.__esModule)return e;var d=e.default;if("function"==typeof d){var o=function e(){if(this instanceof e){var o=[null];return o.push.apply(o,arguments),new(Function.bind.apply(d,o))}return d.apply(this,arguments)};o.prototype=d.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(e).forEach((function(d){var t=Object.getOwnPropertyDescriptor(e,d);Object.defineProperty(o,d,t.get?t:{enumerable:!0,get:function(){return e[d]}})})),o}var o,t={};!function(e){e.PING="@straddleio/js-bridge/ping",e.ERROR="@straddleio/js-bridge/error",e.INITIALIZE="@straddleio/js-bridge/initialize",e.INITIALIZING="@straddleio/js-bridge/initializing",e.INITIALIZED="@straddleio/js-bridge/initialized",e.MOUNTED="@straddleio/js-bridge/mounted",e.ON_PAYKEY="@straddleio/js-bridge/on-paykey",e.ON_SUCCESS="@straddleio/js-bridge/on-success",e.ON_SUCCESS_CTA_CLICKED="@straddleio/js-bridge/on-success-cta-clicked",e.ON_CLOSE="@straddleio/js-bridge/on-close",e.ON_MANUAL_ENTRY="@straddleio/js-bridge/on-manual-entry",e.ON_RETRY="@straddleio/js-bridge/on-retry",e.TOKEN="@straddleio/js-bridge/token",e.DEBUG="@straddleio/js-bridge/debug",e.CONSOLE="@straddleio/js-bridge/console"}(o||(o={}));var r=d(Object.freeze({__proto__:null,get EBridgeMessageType(){return o}}));e.straddleBridge=void 0;var n=r;const i="Straddle-widget-iframe",s={getUrl:()=>`${s.origin}/${encodeURIComponent("undefined"!=typeof window&&window.location.origin)}`,origin:"",mounted:!1,verbose:!1,init:function(e){const{appUrl:d,token:o,onSuccess:t,onSuccessCTAClicked:r,onClose:a,onLoadError:l,onManualEntry:g,onRetry:c,targetRef:u,style:p,className:y,verbose:b=!1}=e;s.origin=null!=d?d:"https://dev.straddle.io",b&&console.log("init called");const f=document.createElement("iframe");f.setAttribute("src",s.getUrl()),f.addEventListener("error",(e=>{console.error("Error loading Straddle Widget"),null==l||l(e)})),f.id=i;let E=p;p||(E={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),Object.assign(f.style,E),y&&y.split(" ").forEach((e=>{f.classList.add(e)})),(u||document.getElementsByTagName("body")[0]).appendChild(f),"undefined"!=typeof window&&window.addEventListener("message",(function(e){var d;if(e.origin===s.origin){b&&console.log("Message received from widget:",e.data.type,e);const l=e.data;switch(null==l?void 0:l.type){case n.EBridgeMessageType.MOUNTED:s.mounted=!0,s.send({type:n.EBridgeMessageType.INITIALIZE,token:o});break;case n.EBridgeMessageType.ON_CLOSE:null==a||a(),s.mounted=!1,null===(d=document.querySelector(`#${i}`))||void 0===d||d.remove();break;case n.EBridgeMessageType.ON_SUCCESS_CTA_CLICKED:document.getElementsByTagName("body")[0].removeChild(f),null==r||r();break;case n.EBridgeMessageType.ON_MANUAL_ENTRY:null==g||g();break;case n.EBridgeMessageType.ON_RETRY:null==c||c();break;case n.EBridgeMessageType.ON_PAYKEY:null==t||t(l.paykeyResponse);break;case n.EBridgeMessageType.CONSOLE:{const e=l.payload.map((e=>{try{return JSON.parse(e)}catch(d){return e}}));"method"in l&&console[l.method].apply(console,e)}}}}))},getIframe:()=>document.getElementById("Straddle-widget-iframe"),show:()=>{s.verbose&&console.log("straddleBridge.show method called.");const e=s.getIframe();s.verbose&&e&&console.log("iframe found, setting display to block."),e.style.display="block"},hide:()=>{s.verbose&&console.log("straddleBridge.hide method called.");const e=s.getIframe();s.verbose&&e&&console.log("iframe found, setting display to none."),e.style.display="none"},remove:()=>{s.verbose&&console.log("straddleBridge.remove method called."),s.getIframe().remove(),s.mounted=!1},send:function(e){var d;const o=document.getElementById("Straddle-widget-iframe");console.log("sending message:",e),null===(d=null==o?void 0:o.contentWindow)||void 0===d||d.postMessage(e,s.origin)}};return"undefined"!=typeof window&&(window.straddleBridge=s),Object.defineProperty(s,"debug",{value:{enable:()=>s.send({type:n.EBridgeMessageType.DEBUG,enable:!0}),disable:()=>s.send({type:n.EBridgeMessageType.DEBUG,enable:!1})},enumerable:!1,writable:!1,configurable:!1}),e.straddleBridge=t.straddleBridge=s,e.default=t,Object.defineProperty(e,"__esModule",{value:!0}),e}({});

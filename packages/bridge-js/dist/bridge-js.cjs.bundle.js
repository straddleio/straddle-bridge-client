var StraddleBridge=function(e){"use strict";function r(e){if(e.__esModule)return e;var r=e.default;if("function"==typeof r){var o=function e(){if(this instanceof e){var o=[null];return o.push.apply(o,arguments),new(Function.bind.apply(r,o))}return r.apply(this,arguments)};o.prototype=r.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(o,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),o}var o,n={};!function(e){e.PING="@straddlecom/js-bridge/ping",e.ERROR="@straddlecom/js-bridge/error",e.INITIALIZE="@straddlecom/js-bridge/initialize",e.INITIALIZING="@straddlecom/js-bridge/initializing",e.INITIALIZED="@straddlecom/js-bridge/initialized",e.MOUNTED="@straddlecom/js-bridge/mounted",e.ON_PAYKEY="@straddlecom/js-bridge/on-paykey",e.ON_SUCCESS="@straddlecom/js-bridge/on-success",e.ON_SUCCESS_CTA_CLICKED="@straddlecom/js-bridge/on-success-cta-clicked",e.ON_CLOSE="@straddlecom/js-bridge/on-close",e.ON_MANUAL_ENTRY="@straddlecom/js-bridge/on-manual-entry",e.ON_RETRY="@straddlecom/js-bridge/on-retry",e.TOKEN="@straddlecom/js-bridge/token",e.DEBUG="@straddlecom/js-bridge/debug",e.CONSOLE="@straddlecom/js-bridge/console"}(o||(o={}));var d=r(Object.freeze({__proto__:null,get EBridgeMessageType(){return o}}));e.straddleBridge=void 0;var t=d;const i="Straddle-widget-iframe",s="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",a={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},l=(...e)=>console.log("%c●%c",s,"",...e),c={production:"https://bridge.straddle.io",sandbox:"https://bridge-sandbox.straddle.io"},g={getUrl:()=>{const[e,r]=["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")];return`${g.origin}/?parentOriginURL=${e}&parentOriginProtocol=${r}`},origin:"",mounted:!1,verbose:!1,messageHandler:void 0,iframeErrorHandler:void 0,init:function(e){let{mode:r,appUrl:o,token:n,onSuccess:d,onSuccessCTAClicked:p,onClose:u,onLoadError:m,allowManualEntry:b=!0,onManualEntry:f,onRetry:E,targetRef:y,style:v,className:O,verbose:w=!1}=e;o=null!=o?o:(e=>c[null!=e?e:"production"])(r),o=o.endsWith("/")?o.slice(0,-1):o,g.origin=null!=o?o:"https://bridge.straddle.io",g.verbose=!!w,w&&l("init called");const N=document.createElement("iframe");N.setAttribute("src",`${g.getUrl()}&allowManualEntry=${b}`),g.iframeErrorHandler=e=>{((...e)=>{console.error("%c●%c",s,"",...e)})("Error loading Straddle Widget"),null==m||m({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},N.addEventListener("error",g.iframeErrorHandler),N.id=i;let B=v;v||(B={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),Object.assign(N.style,B),O&&O.split(" ").forEach((e=>{N.classList.add(e)})),(y||document.getElementsByTagName("body")[0]).appendChild(N),"undefined"!=typeof window&&(g.messageHandler&&window.removeEventListener("message",g.messageHandler),g.messageHandler=function(e){var r;if(e.origin===g.origin){w&&e.data.type!==t.EBridgeMessageType.CONSOLE&&l("Message received from Bridge app:",e.data.type,e);const o=e.data;switch(null==o?void 0:o.type){case t.EBridgeMessageType.PING:break;case t.EBridgeMessageType.MOUNTED:g.mounted=!0,g.send({type:t.EBridgeMessageType.INITIALIZE,token:n});break;case t.EBridgeMessageType.ON_CLOSE:null==u||u(),g.remove();break;case t.EBridgeMessageType.ON_SUCCESS_CTA_CLICKED:null==p||p(),g.remove();break;case t.EBridgeMessageType.ON_MANUAL_ENTRY:null==f||f();break;case t.EBridgeMessageType.ON_RETRY:null==E||E();break;case t.EBridgeMessageType.ON_PAYKEY:null==d||d(o.paykeyResponse);break;case t.EBridgeMessageType.ERROR:null==m||m(Object.assign(Object.assign({error_code:"init_error"},o.payload),{origin:e.origin}));break;case t.EBridgeMessageType.CONSOLE:{const e=o.payload.map((e=>{try{return JSON.parse(e)}catch(r){return e}}));if("method"in o){const n=o.method;(null===(r=a[n])||void 0===r?void 0:r.conditionFn(!!w))&&console[n].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}}}},window.addEventListener("message",g.messageHandler))},getIframe:()=>document.getElementById(i),show:()=>{g.verbose&&console.log("straddleBridge.show method called.");const e=g.getIframe();g.verbose&&e&&console.log("iframe found, setting display to block."),e.style.display="block"},hide:()=>{g.verbose&&console.log("straddleBridge.hide method called.");const e=g.getIframe();g.verbose&&e&&console.log("iframe found, setting display to none."),e.style.display="none"},remove:()=>{g.verbose&&console.log("straddleBridge.remove method called."),"undefined"!=typeof window&&g.messageHandler&&(window.removeEventListener("message",g.messageHandler),g.messageHandler=void 0);const e=g.getIframe();e&&g.iframeErrorHandler&&(e.removeEventListener("error",g.iframeErrorHandler),g.iframeErrorHandler=void 0),null==e||e.remove(),g.mounted=!1},send:function(e){var r;const o=document.getElementById(i);o?(g.verbose&&l("Bridge client: Sending message to iframe with target:",g.origin,", message:",e),null===(r=o.contentWindow)||void 0===r||r.postMessage(e,g.origin)):g.verbose&&l("Bridge client","No iframe found, message not sent:",e)}};return"undefined"!=typeof window&&(window.straddleBridge=g),Object.defineProperty(g,"debug",{value:{enable:()=>g.send({type:t.EBridgeMessageType.DEBUG,enable:!0}),disable:()=>g.send({type:t.EBridgeMessageType.DEBUG,enable:!1})},enumerable:!1,writable:!1,configurable:!1}),e.straddleBridge=n.straddleBridge=g,e.default=n,Object.defineProperty(e,"__esModule",{value:!0}),e}({});

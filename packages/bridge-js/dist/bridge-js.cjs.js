"use strict";var e=require("@straddleio/bridge-core");const o="Straddle-widget-iframe",t={production:"https://bridge.straddle.io",sandbox:"https://bridge-sandbox.straddle.io"},n={getUrl:()=>`${n.origin}/${"undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://",""))}`,origin:"",mounted:!1,verbose:!1,init:function(d){let{mode:s,appUrl:r,token:l,onSuccess:a,onSuccessCTAClicked:i,onClose:g,onLoadError:c,allowManualEntry:u=!0,onManualEntry:p,onRetry:m,targetRef:y,style:E,className:b,verbose:f=!1}=d;r=null!=r?r:(e=>t[null!=e?e:"production"])(s),r=r.endsWith("/")?r.slice(0,-1):r,n.origin=null!=r?r:"https://production.straddle.io",f&&console.log("init called");const w=document.createElement("iframe");w.setAttribute("src",n.getUrl()+"?allowManualEntry="+u),w.addEventListener("error",(e=>{console.error("Error loading Straddle Widget"),null==c||c(e)})),w.id=o;let v=E;E||(v={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),Object.assign(w.style,v),b&&b.split(" ").forEach((e=>{w.classList.add(e)})),(y||document.getElementsByTagName("body")[0]).appendChild(w),"undefined"!=typeof window&&window.addEventListener("message",(function(t){var d,s,r;if(t.origin===n.origin){f&&console.log("Message received from widget:",t.data.type,t),f&&(()=>{try{return window.self!==window.top}catch(e){return!0}})()&&(null===(s=null===(d=window.parent)||void 0===d?void 0:d.postMessage)||void 0===s||s.call(d,t.data,"*"));const c=t.data;switch(null==c?void 0:c.type){case e.EBridgeMessageType.MOUNTED:n.mounted=!0,n.send({type:e.EBridgeMessageType.INITIALIZE,token:l});break;case e.EBridgeMessageType.ON_CLOSE:null==g||g(),n.mounted=!1,null===(r=document.querySelector(`#${o}`))||void 0===r||r.remove();break;case e.EBridgeMessageType.ON_SUCCESS_CTA_CLICKED:document.getElementsByTagName("body")[0].removeChild(w),null==i||i();break;case e.EBridgeMessageType.ON_MANUAL_ENTRY:null==p||p();break;case e.EBridgeMessageType.ON_RETRY:null==m||m();break;case e.EBridgeMessageType.ON_PAYKEY:null==a||a(c.paykeyResponse);break;case e.EBridgeMessageType.CONSOLE:{const e=c.payload.map((e=>{try{return JSON.parse(e)}catch(o){return e}}));"method"in c&&console[c.method].apply(console,e)}}}}))},getIframe:()=>document.getElementById("Straddle-widget-iframe"),show:()=>{n.verbose&&console.log("straddleBridge.show method called.");const e=n.getIframe();n.verbose&&e&&console.log("iframe found, setting display to block."),e.style.display="block"},hide:()=>{n.verbose&&console.log("straddleBridge.hide method called.");const e=n.getIframe();n.verbose&&e&&console.log("iframe found, setting display to none."),e.style.display="none"},remove:()=>{n.verbose&&console.log("straddleBridge.remove method called.");const e=n.getIframe();null==e||e.remove(),n.mounted=!1},send:function(e){var o;const t=document.getElementById("Straddle-widget-iframe");console.log("sending message:",e,"to",n.origin),null===(o=null==t?void 0:t.contentWindow)||void 0===o||o.postMessage(e,n.origin)}};"undefined"!=typeof window&&(window.straddleBridge=n),Object.defineProperty(n,"debug",{value:{enable:()=>n.send({type:e.EBridgeMessageType.DEBUG,enable:!0}),disable:()=>n.send({type:e.EBridgeMessageType.DEBUG,enable:!1})},enumerable:!1,writable:!1,configurable:!1}),exports.straddleBridge=n;
//# sourceMappingURL=bridge-js.cjs.js.map

"use strict";var e=require("@straddlecom/bridge-core");const o="Straddle-widget-iframe",n="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",r={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},d=(...e)=>console.log("%c●%c",n,"",...e),i={production:"https://bridge.straddle.com",sandbox:"https://bridge-sandbox.straddle.com"},t=()=>"undefined"==typeof window?{mounted:!1,mounting:!1}:(window.__STRADDLE_BRIDGE__||(window.__STRADDLE_BRIDGE__={mounted:!1,mounting:!1}),window.__STRADDLE_BRIDGE__),s={getUrl:()=>{const[e,o]=["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")];return`${s.origin}/?parentOriginURL=${e}&parentOriginProtocol=${o}`},origin:"",mounted:!1,verbose:!1,owner:void 0,messageHandler:void 0,iframeErrorHandler:void 0,init:function(a){let{mode:l,appUrl:g,token:c,onSuccess:m,onSuccessCTAClicked:p,onClose:u,onLoadError:y,allowManualEntry:E=!0,onManualEntry:w,onRetry:f,targetRef:b,style:v,className:B,verbose:_=!1}=a;g=null!=g?g:(e=>i[null!=e?e:"sandbox"])(l),g=g.endsWith("/")?g.slice(0,-1):g,s.origin=null!=g?g:"https://bridge.straddle.com",s.verbose=!!_,_&&d("init called");const h=t();if(h.mounting||h.mounted)return void(_&&((...e)=>{console.warn("%c●%c",n,"",...e)})("StraddleBridge already mounted; skipping duplicate mount."));h.mounting=!0,s.owner=Symbol("STRADDLE_BRIDGE_OWNER"),h.owner=s.owner;const T=document.createElement("iframe");T.setAttribute("src",`${s.getUrl()}&allowManualEntry=${E}`),s.iframeErrorHandler=e=>{((...e)=>{console.error("%c●%c",n,"",...e)})("Error loading Straddle Widget"),null==y||y({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},T.addEventListener("error",s.iframeErrorHandler),T.id=o;let O=v;v||(O={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),Object.assign(T.style,O),B&&B.split(" ").forEach((e=>{T.classList.add(e)})),(b||document.getElementsByTagName("body")[0]).appendChild(T),"undefined"!=typeof window&&(s.messageHandler&&window.removeEventListener("message",s.messageHandler),s.messageHandler=function(o){var n,i;const t=o.data,a=Object.assign(Object.assign({},t),{type:"string"==typeof(null==t?void 0:t.type)?t.type.replace("@straddleio/","@straddlecom/"):null==t?void 0:t.type});if((null===(n=null==a?void 0:a.type)||void 0===n?void 0:n.includes("@straddlecom/"))&&o.origin!==s.origin&&_&&d("Message received from Bridge app but from unknown origin:",o.origin,o.data),o.origin===s.origin)switch(_&&a.type!==e.EBridgeMessageType.CONSOLE&&d("Message received from Bridge app:",a.type,o),a.type){case e.EBridgeMessageType.PING:break;case e.EBridgeMessageType.MOUNTED:s.mounted=!0,s.send({type:e.EBridgeMessageType.INITIALIZE,token:c});break;case e.EBridgeMessageType.ON_CLOSE:null==u||u(),s.remove();break;case e.EBridgeMessageType.ON_SUCCESS_CTA_CLICKED:null==p||p(),s.remove();break;case e.EBridgeMessageType.ON_MANUAL_ENTRY:null==w||w();break;case e.EBridgeMessageType.ON_RETRY:null==f||f();break;case e.EBridgeMessageType.ON_PAYKEY:null==m||m(a.paykeyResponse);break;case e.EBridgeMessageType.ERROR:null==y||y(Object.assign(Object.assign({error_code:"init_error"},a.payload),{origin:o.origin}));break;case e.EBridgeMessageType.CONSOLE:{const e=a.payload.map((e=>{try{return JSON.parse(e)}catch(o){return e}}));if("method"in a){const o=a.method;(null===(i=r[o])||void 0===i?void 0:i.conditionFn(!!_))&&console[o].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}}},window.addEventListener("message",s.messageHandler)),h.mounting=!1,h.mounted=!0},getIframe:()=>document.getElementById(o),show:()=>{s.verbose&&console.log("straddleBridge.show method called.");const e=s.getIframe();s.verbose&&e&&console.log("iframe found, setting display to block."),e.style.display="block"},hide:()=>{s.verbose&&console.log("straddleBridge.hide method called.");const e=s.getIframe();s.verbose&&e&&console.log("iframe found, setting display to none."),e.style.display="none"},remove:()=>{s.verbose&&console.log("straddleBridge.remove method called.");const e=t();if(!e.owner||!s.owner||e.owner!==s.owner)return void(s.verbose&&console.log("remove called by non-owner; ignoring."));"undefined"!=typeof window&&s.messageHandler&&(window.removeEventListener("message",s.messageHandler),s.messageHandler=void 0);const o=s.getIframe();o&&s.iframeErrorHandler&&(o.removeEventListener("error",s.iframeErrorHandler),s.iframeErrorHandler=void 0),null==o||o.remove(),s.mounted=!1,e.mounted=!1,e.mounting=!1,e.owner=void 0,s.owner=void 0},send:function(e){var n;const r=document.getElementById(o);r?(s.verbose&&d("Bridge client: Sending message to iframe with target:",s.origin,", message:",e),null===(n=r.contentWindow)||void 0===n||n.postMessage(e,s.origin)):s.verbose&&d("Bridge client","No iframe found, message not sent:",e)}};"undefined"!=typeof window&&(window.straddleBridge=s),Object.defineProperty(s,"debug",{value:{enable:()=>s.send({type:e.EBridgeMessageType.DEBUG,enable:!0}),disable:()=>s.send({type:e.EBridgeMessageType.DEBUG,enable:!1})},enumerable:!1,writable:!1,configurable:!1}),exports.straddleBridge=s;
//# sourceMappingURL=bridge-js.cjs.js.map

"use strict";var e=require("@straddlecom/bridge-core");const r="Straddle-widget-iframe",o="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",n={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},d=(...e)=>console.log("%c●%c",o,"",...e),i={production:"https://bridge.straddle.com",sandbox:"https://bridge-sandbox.straddle.com"},t={getUrl:()=>{const[e,r]=["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")];return`${t.origin}/?parentOriginURL=${e}&parentOriginProtocol=${r}`},origin:"",mounted:!1,verbose:!1,messageHandler:void 0,iframeErrorHandler:void 0,init:function(s){let{mode:a,appUrl:l,token:g,onSuccess:c,onSuccessCTAClicked:p,onClose:m,onLoadError:u,allowManualEntry:y=!0,onManualEntry:f,onRetry:b,targetRef:E,style:v,className:w,verbose:B=!1}=s;l=null!=l?l:(e=>i[null!=e?e:"production"])(a),l=l.endsWith("/")?l.slice(0,-1):l,t.origin=null!=l?l:"https://bridge.straddle.com",t.verbose=!!B,B&&d("init called");const h=document.createElement("iframe");h.setAttribute("src",`${t.getUrl()}&allowManualEntry=${y}`),t.iframeErrorHandler=e=>{((...e)=>{console.error("%c●%c",o,"",...e)})("Error loading Straddle Widget"),null==u||u({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},h.addEventListener("error",t.iframeErrorHandler),h.id=r;let M=v;v||(M={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),Object.assign(h.style,M),w&&w.split(" ").forEach((e=>{h.classList.add(e)})),(E||document.getElementsByTagName("body")[0]).appendChild(h),"undefined"!=typeof window&&(t.messageHandler&&window.removeEventListener("message",t.messageHandler),t.messageHandler=function(r){var o,i;const s=r.data,a=Object.assign(Object.assign({},s),{type:"string"==typeof(null==s?void 0:s.type)?s.type.replace("@straddleio/","@straddlecom/"):null==s?void 0:s.type});if((null===(o=null==a?void 0:a.type)||void 0===o?void 0:o.includes("@straddlecom/"))&&r.origin!==t.origin&&B&&d("Message received from Bridge app but from unknown origin:",r.origin,r.data),r.origin===t.origin)switch(B&&a.type!==e.EBridgeMessageType.CONSOLE&&d("Message received from Bridge app:",a.type,r),a.type){case e.EBridgeMessageType.PING:break;case e.EBridgeMessageType.MOUNTED:t.mounted=!0,t.send({type:e.EBridgeMessageType.INITIALIZE,token:g});break;case e.EBridgeMessageType.ON_CLOSE:null==m||m(),t.remove();break;case e.EBridgeMessageType.ON_SUCCESS_CTA_CLICKED:null==p||p(),t.remove();break;case e.EBridgeMessageType.ON_MANUAL_ENTRY:null==f||f();break;case e.EBridgeMessageType.ON_RETRY:null==b||b();break;case e.EBridgeMessageType.ON_PAYKEY:null==c||c(a.paykeyResponse);break;case e.EBridgeMessageType.ERROR:null==u||u(Object.assign(Object.assign({error_code:"init_error"},a.payload),{origin:r.origin}));break;case e.EBridgeMessageType.CONSOLE:{const e=a.payload.map((e=>{try{return JSON.parse(e)}catch(r){return e}}));if("method"in a){const r=a.method;(null===(i=n[r])||void 0===i?void 0:i.conditionFn(!!B))&&console[r].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}}},window.addEventListener("message",t.messageHandler))},getIframe:()=>document.getElementById(r),show:()=>{t.verbose&&console.log("straddleBridge.show method called.");const e=t.getIframe();t.verbose&&e&&console.log("iframe found, setting display to block."),e.style.display="block"},hide:()=>{t.verbose&&console.log("straddleBridge.hide method called.");const e=t.getIframe();t.verbose&&e&&console.log("iframe found, setting display to none."),e.style.display="none"},remove:()=>{t.verbose&&console.log("straddleBridge.remove method called."),"undefined"!=typeof window&&t.messageHandler&&(window.removeEventListener("message",t.messageHandler),t.messageHandler=void 0);const e=t.getIframe();e&&t.iframeErrorHandler&&(e.removeEventListener("error",t.iframeErrorHandler),t.iframeErrorHandler=void 0),null==e||e.remove(),t.mounted=!1},send:function(e){var o;const n=document.getElementById(r);n?(t.verbose&&d("Bridge client: Sending message to iframe with target:",t.origin,", message:",e),null===(o=n.contentWindow)||void 0===o||o.postMessage(e,t.origin)):t.verbose&&d("Bridge client","No iframe found, message not sent:",e)}};"undefined"!=typeof window&&(window.straddleBridge=t),Object.defineProperty(t,"debug",{value:{enable:()=>t.send({type:e.EBridgeMessageType.DEBUG,enable:!0}),disable:()=>t.send({type:e.EBridgeMessageType.DEBUG,enable:!1})},enumerable:!1,writable:!1,configurable:!1}),exports.straddleBridge=t;
//# sourceMappingURL=bridge-js.cjs.js.map

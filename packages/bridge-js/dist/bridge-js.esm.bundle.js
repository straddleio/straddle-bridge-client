var StraddleBridge=function(e){"use strict";var r;!function(e){e.PING="@straddleio/js-bridge/ping",e.ERROR="@straddleio/js-bridge/error",e.INITIALIZE="@straddleio/js-bridge/initialize",e.INITIALIZING="@straddleio/js-bridge/initializing",e.INITIALIZED="@straddleio/js-bridge/initialized",e.MOUNTED="@straddleio/js-bridge/mounted",e.ON_PAYKEY="@straddleio/js-bridge/on-paykey",e.ON_SUCCESS="@straddleio/js-bridge/on-success",e.ON_SUCCESS_CTA_CLICKED="@straddleio/js-bridge/on-success-cta-clicked",e.ON_CLOSE="@straddleio/js-bridge/on-close",e.ON_MANUAL_ENTRY="@straddleio/js-bridge/on-manual-entry",e.ON_RETRY="@straddleio/js-bridge/on-retry",e.TOKEN="@straddleio/js-bridge/token",e.DEBUG="@straddleio/js-bridge/debug",e.CONSOLE="@straddleio/js-bridge/console"}(r||(r={}));const o="Straddle-widget-iframe",n="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",d={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},i=(...e)=>console.log("%c●%c",n,"",...e),t={production:"https://bridge.straddle.io",sandbox:"https://bridge-sandbox.straddle.io"},a={getUrl:()=>{const[e,r]=["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")];return`${a.origin}/?parentOriginURL=${e}&parentOriginProtocol=${r}`},origin:"",mounted:!1,verbose:!1,messageHandler:void 0,iframeErrorHandler:void 0,init:function(e){let{mode:s,appUrl:l,token:c,onSuccess:g,onSuccessCTAClicked:m,onClose:b,onLoadError:u,allowManualEntry:p=!0,onManualEntry:E,onRetry:f,targetRef:v,style:y,className:w,verbose:N=!1}=e;var O;l=null!=l?l:t[null!=(O=s)?O:"production"],l=l.endsWith("/")?l.slice(0,-1):l,a.origin=null!=l?l:"https://bridge.straddle.io",a.verbose=!!N,N&&i("init called");const I=document.createElement("iframe");I.setAttribute("src",`${a.getUrl()}&allowManualEntry=${p}`),a.iframeErrorHandler=e=>{((...e)=>{console.error("%c●%c",n,"",...e)})("Error loading Straddle Widget"),null==u||u({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},I.addEventListener("error",a.iframeErrorHandler),I.id=o;let h=y;y||(h={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),Object.assign(I.style,h),w&&w.split(" ").forEach((e=>{I.classList.add(e)})),(v||document.getElementsByTagName("body")[0]).appendChild(I),"undefined"!=typeof window&&(a.messageHandler&&window.removeEventListener("message",a.messageHandler),a.messageHandler=function(e){var o;if(e.origin===a.origin){N&&e.data.type!==r.CONSOLE&&i("Message received from Bridge app:",e.data.type,e);const n=e.data;switch(null==n?void 0:n.type){case r.PING:break;case r.MOUNTED:a.mounted=!0,a.send({type:r.INITIALIZE,token:c});break;case r.ON_CLOSE:null==b||b(),a.remove();break;case r.ON_SUCCESS_CTA_CLICKED:null==m||m(),a.remove();break;case r.ON_MANUAL_ENTRY:null==E||E();break;case r.ON_RETRY:null==f||f();break;case r.ON_PAYKEY:null==g||g(n.paykeyResponse);break;case r.ERROR:null==u||u(Object.assign(Object.assign({error_code:"init_error"},n.payload),{origin:e.origin}));break;case r.CONSOLE:{const e=n.payload.map((e=>{try{return JSON.parse(e)}catch(r){return e}}));if("method"in n){const r=n.method;(null===(o=d[r])||void 0===o?void 0:o.conditionFn(!!N))&&console[r].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}}}},window.addEventListener("message",a.messageHandler))},getIframe:()=>document.getElementById(o),show:()=>{a.verbose&&console.log("straddleBridge.show method called.");const e=a.getIframe();a.verbose&&e&&console.log("iframe found, setting display to block."),e.style.display="block"},hide:()=>{a.verbose&&console.log("straddleBridge.hide method called.");const e=a.getIframe();a.verbose&&e&&console.log("iframe found, setting display to none."),e.style.display="none"},remove:()=>{a.verbose&&console.log("straddleBridge.remove method called."),"undefined"!=typeof window&&a.messageHandler&&(window.removeEventListener("message",a.messageHandler),a.messageHandler=void 0);const e=a.getIframe();e&&a.iframeErrorHandler&&(e.removeEventListener("error",a.iframeErrorHandler),a.iframeErrorHandler=void 0),null==e||e.remove(),a.mounted=!1},send:function(e){var r;const n=document.getElementById(o);n?(a.verbose&&i("Bridge client: Sending message to iframe with target:",a.origin,", message:",e),null===(r=n.contentWindow)||void 0===r||r.postMessage(e,a.origin)):a.verbose&&i("Bridge client","No iframe found, message not sent:",e)}};return"undefined"!=typeof window&&(window.straddleBridge=a),Object.defineProperty(a,"debug",{value:{enable:()=>a.send({type:r.DEBUG,enable:!0}),disable:()=>a.send({type:r.DEBUG,enable:!1})},enumerable:!1,writable:!1,configurable:!1}),e.straddleBridge=a,e}({});

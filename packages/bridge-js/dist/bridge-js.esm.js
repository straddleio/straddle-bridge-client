import{EBridgeMessageType as e}from"@straddlecom/bridge-core";const o="Straddle-widget-iframe",n="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",r={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},t=(...e)=>console.log("%c●%c",n,"",...e),d={production:"https://bridge.straddle.com",sandbox:"https://bridge-sandbox.straddle.com"},i=()=>"undefined"==typeof window?{mounted:!1,mounting:!1}:(window.__STRADDLE_BRIDGE__||(window.__STRADDLE_BRIDGE__={mounted:!1,mounting:!1}),window.__STRADDLE_BRIDGE__),a={getUrl:()=>{const[e,o]=["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")];return`${a.origin}/?parentOriginURL=${e}&parentOriginProtocol=${o}`},origin:"",mounted:!1,verbose:!1,owner:void 0,messageHandler:void 0,iframeErrorHandler:void 0,init:function(s){let{mode:l,appUrl:c,token:g,onSuccess:m,onSuccessCTAClicked:u,onClose:p,onLoadError:w,allowManualEntry:f=!0,onManualEntry:b,onRetry:v,targetRef:y,style:E,className:_,verbose:h=!1}=s;c=null!=c?c:(e=>d[null!=e?e:"sandbox"])(l),c=c.endsWith("/")?c.slice(0,-1):c,a.origin=null!=c?c:"https://bridge.straddle.com",a.verbose=!!h,h&&t("init called");const O=i();if(O.mounting||O.mounted)return void(h&&((...e)=>{console.warn("%c●%c",n,"",...e)})("StraddleBridge already mounted; skipping duplicate mount."));O.mounting=!0,a.owner=Symbol("STRADDLE_BRIDGE_OWNER"),O.owner=a.owner;const R=document.createElement("iframe");R.setAttribute("src",`${a.getUrl()}&allowManualEntry=${f}`),a.iframeErrorHandler=e=>{((...e)=>{console.error("%c●%c",n,"",...e)})("Error loading Straddle Widget"),null==w||w({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},R.addEventListener("error",a.iframeErrorHandler),R.id=o;let S=E;E||(S={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),Object.assign(R.style,S),_&&_.split(" ").forEach((e=>{R.classList.add(e)})),(y||document.getElementsByTagName("body")[0]).appendChild(R),"undefined"!=typeof window&&(a.messageHandler&&window.removeEventListener("message",a.messageHandler),a.messageHandler=function(o){var n,d;const i=o.data,s=Object.assign(Object.assign({},i),{type:"string"==typeof(null==i?void 0:i.type)?i.type.replace("@straddleio/","@straddlecom/"):null==i?void 0:i.type});if((null===(n=null==s?void 0:s.type)||void 0===n?void 0:n.includes("@straddlecom/"))&&o.origin!==a.origin&&h&&t("Message received from Bridge app but from unknown origin:",o.origin,o.data),o.origin===a.origin)switch(h&&s.type!==e.CONSOLE&&t("Message received from Bridge app:",s.type,o),s.type){case e.PING:break;case e.MOUNTED:a.mounted=!0,a.send({type:e.INITIALIZE,token:g});break;case e.ON_CLOSE:null==p||p(),a.remove();break;case e.ON_SUCCESS_CTA_CLICKED:null==u||u(),a.remove();break;case e.ON_MANUAL_ENTRY:null==b||b();break;case e.ON_RETRY:null==v||v();break;case e.ON_PAYKEY:null==m||m(s.paykeyResponse);break;case e.ERROR:null==w||w(Object.assign(Object.assign({error_code:"init_error"},s.payload),{origin:o.origin}));break;case e.CONSOLE:{const e=s.payload.map((e=>{try{return JSON.parse(e)}catch(o){return e}}));if("method"in s){const o=s.method;(null===(d=r[o])||void 0===d?void 0:d.conditionFn(!!h))&&console[o].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}}},window.addEventListener("message",a.messageHandler)),O.mounting=!1,O.mounted=!0},getIframe:()=>document.getElementById(o),show:()=>{a.verbose&&console.log("straddleBridge.show method called.");const e=a.getIframe();a.verbose&&e&&console.log("iframe found, setting display to block."),e.style.display="block"},hide:()=>{a.verbose&&console.log("straddleBridge.hide method called.");const e=a.getIframe();a.verbose&&e&&console.log("iframe found, setting display to none."),e.style.display="none"},remove:()=>{a.verbose&&console.log("straddleBridge.remove method called.");const e=i();if(!e.owner||!a.owner||e.owner!==a.owner)return void(a.verbose&&console.log("remove called by non-owner; ignoring."));"undefined"!=typeof window&&a.messageHandler&&(window.removeEventListener("message",a.messageHandler),a.messageHandler=void 0);const o=a.getIframe();o&&a.iframeErrorHandler&&(o.removeEventListener("error",a.iframeErrorHandler),a.iframeErrorHandler=void 0),null==o||o.remove(),a.mounted=!1,e.mounted=!1,e.mounting=!1,e.owner=void 0,a.owner=void 0},send:function(e){var n;const r=document.getElementById(o);r?(a.verbose&&t("Bridge client: Sending message to iframe with target:",a.origin,", message:",e),null===(n=r.contentWindow)||void 0===n||n.postMessage(e,a.origin)):a.verbose&&t("Bridge client","No iframe found, message not sent:",e)}};"undefined"!=typeof window&&(window.straddleBridge=a),Object.defineProperty(a,"debug",{value:{enable:()=>a.send({type:e.DEBUG,enable:!0}),disable:()=>a.send({type:e.DEBUG,enable:!1})},enumerable:!1,writable:!1,configurable:!1});export{a as straddleBridge};
//# sourceMappingURL=bridge-js.esm.js.map

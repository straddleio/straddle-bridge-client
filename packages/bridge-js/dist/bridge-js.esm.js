import{EBridgeMessageType as e}from"@straddleio/bridge-core";const o="Straddle-widget-iframe",n="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",r={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},t=(...e)=>console.log("%c●%c",n,"",...e),d={production:"https://bridge.straddle.io",sandbox:"https://bridge-sandbox.straddle.io"},i={getUrl:()=>{const[e,o]=["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")];return`${i.origin}/?parentOriginURL=${e}&parentOriginProtocol=${o}`},origin:"",mounted:!1,verbose:!1,messageHandler:void 0,iframeErrorHandler:void 0,init:function(a){let{mode:s,appUrl:l,token:c,onSuccess:g,onSuccessCTAClicked:m,onClose:p,onLoadError:u,allowManualEntry:f=!0,onManualEntry:b,onRetry:v,targetRef:w,style:E,className:y,verbose:h=!1}=a;l=null!=l?l:(e=>d[null!=e?e:"production"])(s),l=l.endsWith("/")?l.slice(0,-1):l,i.origin=null!=l?l:"https://bridge.straddle.io",i.verbose=!!h,h&&t("init called");const O=document.createElement("iframe");O.setAttribute("src",`${i.getUrl()}&allowManualEntry=${f}`),i.iframeErrorHandler=e=>{((...e)=>{console.error("%c●%c",n,"",...e)})("Error loading Straddle Widget"),null==u||u({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},O.addEventListener("error",i.iframeErrorHandler),O.id=o;let N=E;E||(N={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),Object.assign(O.style,N),y&&y.split(" ").forEach((e=>{O.classList.add(e)})),(w||document.getElementsByTagName("body")[0]).appendChild(O),"undefined"!=typeof window&&(i.messageHandler&&window.removeEventListener("message",i.messageHandler),i.messageHandler=function(o){var n;if(o.origin===i.origin){h&&o.data.type!==e.CONSOLE&&t("Message received from Bridge app:",o.data.type,o);const d=o.data;switch(null==d?void 0:d.type){case e.PING:break;case e.MOUNTED:i.mounted=!0,i.send({type:e.INITIALIZE,token:c});break;case e.ON_CLOSE:null==p||p(),i.remove();break;case e.ON_SUCCESS_CTA_CLICKED:null==m||m(),i.remove();break;case e.ON_MANUAL_ENTRY:null==b||b();break;case e.ON_RETRY:null==v||v();break;case e.ON_PAYKEY:null==g||g(d.paykeyResponse);break;case e.ERROR:null==u||u(Object.assign(Object.assign({error_code:"init_error"},d.payload),{origin:o.origin}));break;case e.CONSOLE:{const e=d.payload.map((e=>{try{return JSON.parse(e)}catch(o){return e}}));if("method"in d){const o=d.method;(null===(n=r[o])||void 0===n?void 0:n.conditionFn(!!h))&&console[o].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}}}},window.addEventListener("message",i.messageHandler))},getIframe:()=>document.getElementById(o),show:()=>{i.verbose&&console.log("straddleBridge.show method called.");const e=i.getIframe();i.verbose&&e&&console.log("iframe found, setting display to block."),e.style.display="block"},hide:()=>{i.verbose&&console.log("straddleBridge.hide method called.");const e=i.getIframe();i.verbose&&e&&console.log("iframe found, setting display to none."),e.style.display="none"},remove:()=>{i.verbose&&console.log("straddleBridge.remove method called."),"undefined"!=typeof window&&i.messageHandler&&(window.removeEventListener("message",i.messageHandler),i.messageHandler=void 0);const e=i.getIframe();e&&i.iframeErrorHandler&&(e.removeEventListener("error",i.iframeErrorHandler),i.iframeErrorHandler=void 0),null==e||e.remove(),i.mounted=!1},send:function(e){var n;const r=document.getElementById(o);r?(i.verbose&&t("Bridge client: Sending message to iframe with target:",i.origin,", message:",e),null===(n=r.contentWindow)||void 0===n||n.postMessage(e,i.origin)):i.verbose&&t("Bridge client","No iframe found, message not sent:",e)}};"undefined"!=typeof window&&(window.straddleBridge=i),Object.defineProperty(i,"debug",{value:{enable:()=>i.send({type:e.DEBUG,enable:!0}),disable:()=>i.send({type:e.DEBUG,enable:!1})},enumerable:!1,writable:!1,configurable:!1});export{i as straddleBridge};
//# sourceMappingURL=bridge-js.esm.js.map

{"version":3,"file":"bridge-js.umd.bundle.js","sources":["../node_modules/@straddleio/bridge-core/dist/types.js","../src/index.ts"],"sourcesContent":["export var EBridgeMessageType;\n(function (EBridgeMessageType) {\n    EBridgeMessageType[\"PING\"] = \"@straddleio/js-bridge/ping\";\n    EBridgeMessageType[\"ERROR\"] = \"@straddleio/js-bridge/error\";\n    EBridgeMessageType[\"INITIALIZE\"] = \"@straddleio/js-bridge/initialize\";\n    EBridgeMessageType[\"INITIALIZING\"] = \"@straddleio/js-bridge/initializing\";\n    EBridgeMessageType[\"INITIALIZED\"] = \"@straddleio/js-bridge/initialized\";\n    EBridgeMessageType[\"MOUNTED\"] = \"@straddleio/js-bridge/mounted\";\n    EBridgeMessageType[\"ON_PAYKEY\"] = \"@straddleio/js-bridge/on-paykey\";\n    EBridgeMessageType[\"ON_SUCCESS\"] = \"@straddleio/js-bridge/on-success\";\n    EBridgeMessageType[\"ON_SUCCESS_CTA_CLICKED\"] = \"@straddleio/js-bridge/on-success-cta-clicked\";\n    EBridgeMessageType[\"ON_CLOSE\"] = \"@straddleio/js-bridge/on-close\";\n    EBridgeMessageType[\"ON_MANUAL_ENTRY\"] = \"@straddleio/js-bridge/on-manual-entry\";\n    EBridgeMessageType[\"ON_RETRY\"] = \"@straddleio/js-bridge/on-retry\";\n    EBridgeMessageType[\"TOKEN\"] = \"@straddleio/js-bridge/token\";\n    EBridgeMessageType[\"DEBUG\"] = \"@straddleio/js-bridge/debug\";\n    EBridgeMessageType[\"CONSOLE\"] = \"@straddleio/js-bridge/console\";\n})(EBridgeMessageType || (EBridgeMessageType = {}));\n","import { EBridgeMessageType, TMessage, TMode, TPaykeyResponse } from '@straddleio/bridge-core'\nexport type { TMode } from '@straddleio/bridge-core'\n\nconst IFRAME_ID = 'Straddle-widget-iframe'\n\nconst getBridgeParentOrigin = () => typeof window !== 'undefined' && encodeURIComponent(window.location.origin.replace('https://', '').replace('http://', ''))\nconst inIframe = () => {\n    try {\n        return window.self !== window.top\n    } catch (e) {\n        return true\n    }\n}\n\nconst appUrlDictionary: Record<TMode, string> = {\n    production: 'https://bridge.straddle.io',\n    sandbox: 'https://bridge-sandbox.straddle.io',\n}\n\nconst getAppURLFromMode = (mode?: TMode) => appUrlDictionary[mode ?? 'production']\n\nexport const straddleBridge = {\n    getUrl: () => `${straddleBridge.origin}/${getBridgeParentOrigin()}`,\n    origin: '',\n    mounted: false,\n    verbose: false,\n    init: function init(params: {\n        mode?: TMode\n        appUrl?: string\n        token: string\n        onSuccess?: (payload: TPaykeyResponse) => void\n        onSuccessCTAClicked?: () => void\n        onClose?: () => void\n        onLoadError?: (err: ErrorEvent) => void\n        allowManualEntry?: boolean\n        onManualEntry?: () => void\n        onRetry?: () => void\n        targetRef?: HTMLElement | undefined\n        style?: Partial<CSSStyleDeclaration>\n        className?: string\n        verbose?: boolean\n    }) {\n        let {\n            mode,\n            appUrl,\n            token,\n            onSuccess,\n            onSuccessCTAClicked,\n            onClose,\n            onLoadError,\n            allowManualEntry = true,\n            onManualEntry,\n            onRetry,\n            targetRef,\n            style,\n            className,\n            verbose = false,\n        } = params\n        appUrl = appUrl ?? getAppURLFromMode(mode)\n        appUrl = appUrl.endsWith('/') ? appUrl.slice(0, -1) : appUrl\n        straddleBridge.origin = appUrl ?? 'https://production.straddle.io'\n        verbose && console.log('init called')\n        const iframe = document.createElement('iframe')\n        iframe.setAttribute('src', straddleBridge.getUrl() + '?allowManualEntry=' + allowManualEntry)\n        iframe.addEventListener('error', (errorEvent) => {\n            console.error('Error loading Straddle Widget')\n            onLoadError?.(errorEvent)\n        })\n        iframe.id = IFRAME_ID\n        let iframe_style = style\n        if (!style) {\n            iframe_style = { position: 'fixed', width: '100%', height: '100%', top: '0%', left: '0', zIndex: '2147483647' }\n        }\n        Object.assign(iframe.style, iframe_style)\n\n        if (className) {\n            className.split(' ').forEach((className) => {\n                iframe.classList.add(className)\n            })\n        }\n        ;(targetRef || document.getElementsByTagName('body')[0]).appendChild(iframe)\n        typeof window !== 'undefined' &&\n            window.addEventListener('message', function (event: MessageEvent<TMessage>) {\n                if (event.origin === straddleBridge.origin) {\n                    verbose && console.log('Message received from widget:', event.data.type, event)\n                    if (verbose && inIframe()) {\n                        window.parent?.postMessage?.(event.data, '*')\n                    }\n                    const message = event.data\n                    switch (message?.type) {\n                        case EBridgeMessageType.MOUNTED:\n                            straddleBridge.mounted = true\n                            straddleBridge.send({ type: EBridgeMessageType.INITIALIZE, token })\n                            break\n                        case EBridgeMessageType.ON_CLOSE:\n                            onClose?.()\n                            straddleBridge.mounted = false\n                            document.querySelector(`#${IFRAME_ID}`)?.remove()\n                            break\n                        case EBridgeMessageType.ON_SUCCESS_CTA_CLICKED:\n                            document.getElementsByTagName('body')[0].removeChild(iframe)\n                            onSuccessCTAClicked?.()\n                            break\n                        case EBridgeMessageType.ON_MANUAL_ENTRY:\n                            onManualEntry?.()\n                            break\n                        case EBridgeMessageType.ON_RETRY:\n                            onRetry?.()\n                            break\n                        case EBridgeMessageType.ON_PAYKEY:\n                            onSuccess?.(message.paykeyResponse)\n                            // onSuccess?.(message as any)\n                            break\n                        case EBridgeMessageType.CONSOLE:\n                            {\n                                const parsedPayload: any = message.payload.map((item: any) => {\n                                    try {\n                                        return JSON.parse(item)\n                                    } catch {\n                                        return item\n                                    }\n                                })\n                                'method' in message && (console[message.method] as Function).apply(console, parsedPayload)\n                            }\n                            break\n                    }\n                }\n            })\n    },\n    getIframe: () => document.getElementById('Straddle-widget-iframe') as HTMLIFrameElement,\n    show: () => {\n        straddleBridge.verbose && console.log('straddleBridge.show method called.')\n        const iframe = straddleBridge.getIframe()\n        straddleBridge.verbose && iframe && console.log('iframe found, setting display to block.')\n        iframe.style.display = 'block'\n    },\n    hide: () => {\n        straddleBridge.verbose && console.log('straddleBridge.hide method called.')\n        const iframe = straddleBridge.getIframe()\n        straddleBridge.verbose && iframe && console.log('iframe found, setting display to none.')\n        iframe.style.display = 'none'\n    },\n    remove: () => {\n        straddleBridge.verbose && console.log('straddleBridge.remove method called.')\n        const iframe = straddleBridge.getIframe()\n        iframe?.remove()\n        straddleBridge.mounted = false\n    },\n    send: function send(message: TMessage) {\n        const iframe = document.getElementById('Straddle-widget-iframe') as HTMLIFrameElement\n        console.log('sending message:', message, 'to', straddleBridge.origin)\n        iframe?.contentWindow?.postMessage(message, straddleBridge.origin)\n    },\n}\ntypeof window !== 'undefined' && ((window as any).straddleBridge = straddleBridge)\n\nObject.defineProperty(straddleBridge, 'debug', {\n    value: {\n        enable: () => straddleBridge.send({ type: EBridgeMessageType.DEBUG, enable: true }),\n        disable: () => straddleBridge.send({ type: EBridgeMessageType.DEBUG, enable: false }),\n    },\n    enumerable: false,\n    writable: false,\n    configurable: false,\n})\n"],"names":["EBridgeMessageType","IFRAME_ID","appUrlDictionary","production","sandbox","straddleBridge","getUrl","origin","window","encodeURIComponent","location","replace","mounted","verbose","init","params","mode","appUrl","token","onSuccess","onSuccessCTAClicked","onClose","onLoadError","allowManualEntry","onManualEntry","onRetry","targetRef","style","className","getAppURLFromMode","endsWith","slice","console","log","iframe","document","createElement","setAttribute","addEventListener","errorEvent","error","id","iframe_style","position","width","height","top","left","zIndex","Object","assign","split","forEach","classList","add","getElementsByTagName","appendChild","event","data","type","self","e","inIframe","_b","_a","parent","postMessage","call","message","MOUNTED","send","INITIALIZE","ON_CLOSE","_c","querySelector","remove","ON_SUCCESS_CTA_CLICKED","removeChild","ON_MANUAL_ENTRY","ON_RETRY","ON_PAYKEY","paykeyResponse","CONSOLE","parsedPayload","payload","map","item","JSON","parse","method","apply","getIframe","getElementById","show","display","hide","contentWindow","defineProperty","value","enable","DEBUG","disable","enumerable","writable","configurable"],"mappings":"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","x_google_ignoreList":[0]}
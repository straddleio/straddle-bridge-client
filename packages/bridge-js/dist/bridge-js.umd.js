!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports,require("@straddleio/bridge-core")):"function"==typeof define&&define.amd?define(["exports","@straddleio/bridge-core"],o):o((e="undefined"!=typeof globalThis?globalThis:e||self).StraddleBridge={},e.BridgeCore)}(this,(function(e,o){"use strict";const r="Straddle-widget-iframe",n="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",d={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},i=(...e)=>console.log("%c●%c",n,"",...e),t={production:"https://bridge.straddle.io",sandbox:"https://bridge-sandbox.straddle.io"},s={getUrl:()=>{const[e,o]=["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")];return`${s.origin}/?parentOriginURL=${e}&parentOriginProtocol=${o}`},origin:"",mounted:!1,verbose:!1,messageHandler:void 0,iframeErrorHandler:void 0,init:function(e){let{mode:a,appUrl:l,token:g,onSuccess:c,onSuccessCTAClicked:p,onClose:m,onLoadError:f,allowManualEntry:u=!0,onManualEntry:y,onRetry:b,targetRef:E,style:v,className:w,verbose:h=!1}=e;l=null!=l?l:(e=>t[null!=e?e:"production"])(a),l=l.endsWith("/")?l.slice(0,-1):l,s.origin=null!=l?l:"https://bridge.straddle.io",s.verbose=!!h,h&&i("init called");const B=document.createElement("iframe");B.setAttribute("src",`${s.getUrl()}&allowManualEntry=${u}`),s.iframeErrorHandler=e=>{((...e)=>{console.error("%c●%c",n,"",...e)})("Error loading Straddle Widget"),null==f||f({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},B.addEventListener("error",s.iframeErrorHandler),B.id=r;let T=v;v||(T={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),Object.assign(B.style,T),w&&w.split(" ").forEach((e=>{B.classList.add(e)})),(E||document.getElementsByTagName("body")[0]).appendChild(B),"undefined"!=typeof window&&(s.messageHandler&&window.removeEventListener("message",s.messageHandler),s.messageHandler=function(e){var r;if(e.origin===s.origin){h&&e.data.type!==o.EBridgeMessageType.CONSOLE&&i("Message received from Bridge app:",e.data.type,e);const n=e.data;switch(null==n?void 0:n.type){case o.EBridgeMessageType.PING:break;case o.EBridgeMessageType.MOUNTED:s.mounted=!0,s.send({type:o.EBridgeMessageType.INITIALIZE,token:g});break;case o.EBridgeMessageType.ON_CLOSE:null==m||m(),s.remove();break;case o.EBridgeMessageType.ON_SUCCESS_CTA_CLICKED:null==p||p(),s.remove();break;case o.EBridgeMessageType.ON_MANUAL_ENTRY:null==y||y();break;case o.EBridgeMessageType.ON_RETRY:null==b||b();break;case o.EBridgeMessageType.ON_PAYKEY:null==c||c(n.paykeyResponse);break;case o.EBridgeMessageType.ERROR:null==f||f(Object.assign(Object.assign({error_code:"init_error"},n.payload),{origin:e.origin}));break;case o.EBridgeMessageType.CONSOLE:{const e=n.payload.map((e=>{try{return JSON.parse(e)}catch(o){return e}}));if("method"in n){const o=n.method;(null===(r=d[o])||void 0===r?void 0:r.conditionFn(!!h))&&console[o].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}}}},window.addEventListener("message",s.messageHandler))},getIframe:()=>document.getElementById(r),show:()=>{s.verbose&&console.log("straddleBridge.show method called.");const e=s.getIframe();s.verbose&&e&&console.log("iframe found, setting display to block."),e.style.display="block"},hide:()=>{s.verbose&&console.log("straddleBridge.hide method called.");const e=s.getIframe();s.verbose&&e&&console.log("iframe found, setting display to none."),e.style.display="none"},remove:()=>{s.verbose&&console.log("straddleBridge.remove method called."),"undefined"!=typeof window&&s.messageHandler&&(window.removeEventListener("message",s.messageHandler),s.messageHandler=void 0);const e=s.getIframe();e&&s.iframeErrorHandler&&(e.removeEventListener("error",s.iframeErrorHandler),s.iframeErrorHandler=void 0),null==e||e.remove(),s.mounted=!1},send:function(e){var o;const n=document.getElementById(r);n?(s.verbose&&i("Bridge client: Sending message to iframe with target:",s.origin,", message:",e),null===(o=n.contentWindow)||void 0===o||o.postMessage(e,s.origin)):s.verbose&&i("Bridge client","No iframe found, message not sent:",e)}};"undefined"!=typeof window&&(window.straddleBridge=s),Object.defineProperty(s,"debug",{value:{enable:()=>s.send({type:o.EBridgeMessageType.DEBUG,enable:!0}),disable:()=>s.send({type:o.EBridgeMessageType.DEBUG,enable:!1})},enumerable:!1,writable:!1,configurable:!1}),e.straddleBridge=s}));
//# sourceMappingURL=bridge-js.umd.js.map

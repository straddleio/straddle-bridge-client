var StraddleBridge=function(e){"use strict";function r(e){if(e.__esModule)return e;var r=e.default;if("function"==typeof r){var o=function e(){if(this instanceof e){var o=[null];return o.push.apply(o,arguments),new(Function.bind.apply(r,o))}return r.apply(this,arguments)};o.prototype=r.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(o,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),o}var o,n={};!function(e){e.PING="@straddlecom/js-bridge/ping",e.ERROR="@straddlecom/js-bridge/error",e.INITIALIZE="@straddlecom/js-bridge/initialize",e.INITIALIZING="@straddlecom/js-bridge/initializing",e.INITIALIZED="@straddlecom/js-bridge/initialized",e.MOUNTED="@straddlecom/js-bridge/mounted",e.ON_PAYKEY="@straddlecom/js-bridge/on-paykey",e.ON_SUCCESS="@straddlecom/js-bridge/on-success",e.ON_SUCCESS_CTA_CLICKED="@straddlecom/js-bridge/on-success-cta-clicked",e.ON_CLOSE="@straddlecom/js-bridge/on-close",e.ON_MANUAL_ENTRY="@straddlecom/js-bridge/on-manual-entry",e.ON_RETRY="@straddlecom/js-bridge/on-retry",e.TOKEN="@straddlecom/js-bridge/token",e.DEBUG="@straddlecom/js-bridge/debug",e.CONSOLE="@straddlecom/js-bridge/console"}(o||(o={}));var d=r(Object.freeze({__proto__:null,get EBridgeMessageType(){return o}}));e.straddleBridge=void 0;var t=d;const i="Straddle-widget-iframe",s="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",a={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},l=(...e)=>console.log("%c●%c",s,"",...e),g={production:"https://bridge.straddle.com",sandbox:"https://bridge-sandbox.straddle.com"},c=()=>"undefined"==typeof window?{mounted:!1,mounting:!1}:(window.__STRADDLE_BRIDGE__||(window.__STRADDLE_BRIDGE__={mounted:!1,mounting:!1}),window.__STRADDLE_BRIDGE__),u={getUrl:()=>{const[e,r]=["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")];return`${u.origin}/?parentOriginURL=${e}&parentOriginProtocol=${r}`},origin:"",mounted:!1,verbose:!1,owner:void 0,messageHandler:void 0,iframeErrorHandler:void 0,init:function(e){let{mode:r,appUrl:o,token:n,onSuccess:d,onSuccessCTAClicked:m,onClose:p,onLoadError:b,allowManualEntry:y=!0,onManualEntry:E,onRetry:f,targetRef:v,style:w,className:_,verbose:O=!1}=e;o=null!=o?o:(e=>g[null!=e?e:"sandbox"])(r),o=o.endsWith("/")?o.slice(0,-1):o,u.origin=null!=o?o:"https://bridge.straddle.com",u.verbose=!!O,O&&l("init called");const B=c();if(B.mounting||B.mounted)return void(O&&((...e)=>{console.warn("%c●%c",s,"",...e)})("StraddleBridge already mounted; skipping duplicate mount."));B.mounting=!0,u.owner=Symbol("STRADDLE_BRIDGE_OWNER"),B.owner=u.owner;const I=document.createElement("iframe");I.setAttribute("src",`${u.getUrl()}&allowManualEntry=${y}`),u.iframeErrorHandler=e=>{((...e)=>{console.error("%c●%c",s,"",...e)})("Error loading Straddle Widget"),null==b||b({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},I.addEventListener("error",u.iframeErrorHandler),I.id=i;let N=w;w||(N={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),Object.assign(I.style,N),_&&_.split(" ").forEach((e=>{I.classList.add(e)})),(v||document.getElementsByTagName("body")[0]).appendChild(I),"undefined"!=typeof window&&(u.messageHandler&&window.removeEventListener("message",u.messageHandler),u.messageHandler=function(e){var r,o;const i=e.data,s=Object.assign(Object.assign({},i),{type:"string"==typeof(null==i?void 0:i.type)?i.type.replace("@straddleio/","@straddlecom/"):null==i?void 0:i.type});if((null===(r=null==s?void 0:s.type)||void 0===r?void 0:r.includes("@straddlecom/"))&&e.origin!==u.origin&&O&&l("Message received from Bridge app but from unknown origin:",e.origin,e.data),e.origin===u.origin)switch(O&&s.type!==t.EBridgeMessageType.CONSOLE&&l("Message received from Bridge app:",s.type,e),s.type){case t.EBridgeMessageType.PING:break;case t.EBridgeMessageType.MOUNTED:u.mounted=!0,u.send({type:t.EBridgeMessageType.INITIALIZE,token:n});break;case t.EBridgeMessageType.ON_CLOSE:null==p||p(),u.remove();break;case t.EBridgeMessageType.ON_SUCCESS_CTA_CLICKED:null==m||m(),u.remove();break;case t.EBridgeMessageType.ON_MANUAL_ENTRY:null==E||E();break;case t.EBridgeMessageType.ON_RETRY:null==f||f();break;case t.EBridgeMessageType.ON_PAYKEY:null==d||d(s.paykeyResponse);break;case t.EBridgeMessageType.ERROR:null==b||b(Object.assign(Object.assign({error_code:"init_error"},s.payload),{origin:e.origin}));break;case t.EBridgeMessageType.CONSOLE:{const e=s.payload.map((e=>{try{return JSON.parse(e)}catch(r){return e}}));if("method"in s){const r=s.method;(null===(o=a[r])||void 0===o?void 0:o.conditionFn(!!O))&&console[r].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}}},window.addEventListener("message",u.messageHandler)),B.mounting=!1,B.mounted=!0},getIframe:()=>document.getElementById(i),show:()=>{u.verbose&&console.log("straddleBridge.show method called.");const e=u.getIframe();u.verbose&&e&&console.log("iframe found, setting display to block."),e.style.display="block"},hide:()=>{u.verbose&&console.log("straddleBridge.hide method called.");const e=u.getIframe();u.verbose&&e&&console.log("iframe found, setting display to none."),e.style.display="none"},remove:()=>{u.verbose&&console.log("straddleBridge.remove method called.");const e=c();if(!e.owner||!u.owner||e.owner!==u.owner)return void(u.verbose&&console.log("remove called by non-owner; ignoring."));"undefined"!=typeof window&&u.messageHandler&&(window.removeEventListener("message",u.messageHandler),u.messageHandler=void 0);const r=u.getIframe();r&&u.iframeErrorHandler&&(r.removeEventListener("error",u.iframeErrorHandler),u.iframeErrorHandler=void 0),null==r||r.remove(),u.mounted=!1,e.mounted=!1,e.mounting=!1,e.owner=void 0,u.owner=void 0},send:function(e){var r;const o=document.getElementById(i);o?(u.verbose&&l("Bridge client: Sending message to iframe with target:",u.origin,", message:",e),null===(r=o.contentWindow)||void 0===r||r.postMessage(e,u.origin)):u.verbose&&l("Bridge client","No iframe found, message not sent:",e)}};return"undefined"!=typeof window&&(window.straddleBridge=u),Object.defineProperty(u,"debug",{value:{enable:()=>u.send({type:t.EBridgeMessageType.DEBUG,enable:!0}),disable:()=>u.send({type:t.EBridgeMessageType.DEBUG,enable:!1})},enumerable:!1,writable:!1,configurable:!1}),e.straddleBridge=n.straddleBridge=u,e.default=n,Object.defineProperty(e,"__esModule",{value:!0}),e}({});

var StraddleBridge=function(e){"use strict";var o;!function(e){e.PING="@straddlecom/js-bridge/ping",e.ERROR="@straddlecom/js-bridge/error",e.INITIALIZE="@straddlecom/js-bridge/initialize",e.INITIALIZING="@straddlecom/js-bridge/initializing",e.INITIALIZED="@straddlecom/js-bridge/initialized",e.MOUNTED="@straddlecom/js-bridge/mounted",e.ON_PAYKEY="@straddlecom/js-bridge/on-paykey",e.ON_SUCCESS="@straddlecom/js-bridge/on-success",e.ON_SUCCESS_CTA_CLICKED="@straddlecom/js-bridge/on-success-cta-clicked",e.ON_CLOSE="@straddlecom/js-bridge/on-close",e.ON_MANUAL_ENTRY="@straddlecom/js-bridge/on-manual-entry",e.ON_RETRY="@straddlecom/js-bridge/on-retry",e.TOKEN="@straddlecom/js-bridge/token",e.DEBUG="@straddlecom/js-bridge/debug",e.CONSOLE="@straddlecom/js-bridge/console"}(o||(o={}));const n="Straddle-widget-iframe",r="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",d={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},i=(...e)=>console.log("%c●%c",r,"",...e),t={production:"https://bridge.straddle.com",sandbox:"https://bridge-sandbox.straddle.com"},s=()=>"undefined"==typeof window?{mounted:!1,mounting:!1}:(window.__STRADDLE_BRIDGE__||(window.__STRADDLE_BRIDGE__={mounted:!1,mounting:!1}),window.__STRADDLE_BRIDGE__),a={getUrl:()=>{const[e,o]=["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")];return`${a.origin}/?parentOriginURL=${e}&parentOriginProtocol=${o}`},origin:"",mounted:!1,verbose:!1,owner:void 0,messageHandler:void 0,iframeErrorHandler:void 0,init:function(e){let{mode:l,appUrl:c,token:g,onSuccess:m,onSuccessCTAClicked:u,onClose:p,onLoadError:b,allowManualEntry:E=!0,onManualEntry:w,onRetry:f,targetRef:v,style:y,className:_,verbose:O=!1}=e;var I;c=null!=c?c:t[null!=(I=l)?I:"sandbox"],c=c.endsWith("/")?c.slice(0,-1):c,a.origin=null!=c?c:"https://bridge.straddle.com",a.verbose=!!O,O&&i("init called");const N=s();if(N.mounting||N.mounted)return void(O&&((...e)=>{console.warn("%c●%c",r,"",...e)})("StraddleBridge already mounted; skipping duplicate mount."));N.mounting=!0,a.owner=Symbol("STRADDLE_BRIDGE_OWNER"),N.owner=a.owner;const S=document.createElement("iframe");S.setAttribute("src",`${a.getUrl()}&allowManualEntry=${E}`),a.iframeErrorHandler=e=>{((...e)=>{console.error("%c●%c",r,"",...e)})("Error loading Straddle Widget"),null==b||b({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},S.addEventListener("error",a.iframeErrorHandler),S.id=n;let R=y;y||(R={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),Object.assign(S.style,R),_&&_.split(" ").forEach((e=>{S.classList.add(e)})),(v||document.getElementsByTagName("body")[0]).appendChild(S),"undefined"!=typeof window&&(a.messageHandler&&window.removeEventListener("message",a.messageHandler),a.messageHandler=function(e){var n,r;const t=e.data,s=Object.assign(Object.assign({},t),{type:"string"==typeof(null==t?void 0:t.type)?t.type.replace("@straddleio/","@straddlecom/"):null==t?void 0:t.type});if((null===(n=null==s?void 0:s.type)||void 0===n?void 0:n.includes("@straddlecom/"))&&e.origin!==a.origin&&O&&i("Message received from Bridge app but from unknown origin:",e.origin,e.data),e.origin===a.origin)switch(O&&s.type!==o.CONSOLE&&i("Message received from Bridge app:",s.type,e),s.type){case o.PING:break;case o.MOUNTED:a.mounted=!0,a.send({type:o.INITIALIZE,token:g});break;case o.ON_CLOSE:null==p||p(),a.remove();break;case o.ON_SUCCESS_CTA_CLICKED:null==u||u(),a.remove();break;case o.ON_MANUAL_ENTRY:null==w||w();break;case o.ON_RETRY:null==f||f();break;case o.ON_PAYKEY:null==m||m(s.paykeyResponse);break;case o.ERROR:null==b||b(Object.assign(Object.assign({error_code:"init_error"},s.payload),{origin:e.origin}));break;case o.CONSOLE:{const e=s.payload.map((e=>{try{return JSON.parse(e)}catch(o){return e}}));if("method"in s){const o=s.method;(null===(r=d[o])||void 0===r?void 0:r.conditionFn(!!O))&&console[o].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}}},window.addEventListener("message",a.messageHandler)),N.mounting=!1,N.mounted=!0},getIframe:()=>document.getElementById(n),show:()=>{a.verbose&&console.log("straddleBridge.show method called.");const e=a.getIframe();a.verbose&&e&&console.log("iframe found, setting display to block."),e.style.display="block"},hide:()=>{a.verbose&&console.log("straddleBridge.hide method called.");const e=a.getIframe();a.verbose&&e&&console.log("iframe found, setting display to none."),e.style.display="none"},remove:()=>{a.verbose&&console.log("straddleBridge.remove method called.");const e=s();if(!e.owner||!a.owner||e.owner!==a.owner)return void(a.verbose&&console.log("remove called by non-owner; ignoring."));"undefined"!=typeof window&&a.messageHandler&&(window.removeEventListener("message",a.messageHandler),a.messageHandler=void 0);const o=a.getIframe();o&&a.iframeErrorHandler&&(o.removeEventListener("error",a.iframeErrorHandler),a.iframeErrorHandler=void 0),null==o||o.remove(),a.mounted=!1,e.mounted=!1,e.mounting=!1,e.owner=void 0,a.owner=void 0},send:function(e){var o;const r=document.getElementById(n);r?(a.verbose&&i("Bridge client: Sending message to iframe with target:",a.origin,", message:",e),null===(o=r.contentWindow)||void 0===o||o.postMessage(e,a.origin)):a.verbose&&i("Bridge client","No iframe found, message not sent:",e)}};return"undefined"!=typeof window&&(window.straddleBridge=a),Object.defineProperty(a,"debug",{value:{enable:()=>a.send({type:o.DEBUG,enable:!0}),disable:()=>a.send({type:o.DEBUG,enable:!1})},enumerable:!1,writable:!1,configurable:!1}),e.straddleBridge=a,e}({});

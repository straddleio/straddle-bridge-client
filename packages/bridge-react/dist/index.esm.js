import{EBridgeMessageType as e}from"@straddleio/bridge-core";import{forwardRef as n,useRef as o,useEffect as r,useState as t}from"react";const d="Straddle-widget-iframe",a="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",i={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},l=(...e)=>console.log("%c●%c",a,"",...e),s={production:"https://bridge.straddle.io",sandbox:"https://bridge-sandbox.straddle.io"},c=({mode:e,appUrl:n,allowManualEntry:o,verbose:r})=>{n=null!=n?n:(e=>s[null!=e?e:"production"])(e),n=n.endsWith("/")?n.slice(0,-1):n;const[a,i]=t(!1),[c,u]=p();return{send:e=>{var o;const t=document.getElementById(d);t?(r&&l("Sending message to iframe with target:",n,", message:",e),null===(o=t.contentWindow)||void 0===o||o.postMessage(e,n)):r&&console.log("No iframe found, message not sent:",e)},bridgeAppMounted:a,setBridgeAppMounted:i,url:`${n}/?parentOriginURL=${c}&parentOriginProtocol=${u}&allowManualEntry=${o}`,appUrl:n}},p=()=>["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")],u=n(((n,t)=>{const{mode:s,open:p=!0,token:u,onSuccess:g,onSuccessCTAClicked:m,onClose:b,onLoadError:y,allowManualEntry:f=!0,onManualEntry:w,onRetry:E,className:v,style:S,verbose:h}=n,{send:N,setBridgeAppMounted:O,url:C,appUrl:L}=c({mode:s,appUrl:n.appUrl,allowManualEntry:f,verbose:h}),k=o(!1);return r((()=>{var n;let o;const r=function(n){var o,r,t;if(n.origin===L){h&&n.data.type!==e.CONSOLE&&l("Message received from Bridge app:",n.data.type,n);const a=n.data;switch(null==a?void 0:a.type){case e.PING:break;case e.MOUNTED:O(!0),N({type:e.INITIALIZE,token:u});break;case e.ON_CLOSE:null==b||b(),O(!1),null===(o=document.querySelector(`#${d}`))||void 0===o||o.remove();break;case e.ON_SUCCESS_CTA_CLICKED:null==m||m(),null===(r=document.querySelector(`#${d}`))||void 0===r||r.remove();break;case e.ON_PAYKEY:null==g||g(a.paykeyResponse);break;case e.ON_MANUAL_ENTRY:null==w||w();break;case e.ON_RETRY:null==E||E();break;case e.ERROR:null==y||y(Object.assign(Object.assign({error_code:"init_error"},a.payload),{origin:n.origin}));break;case e.CONSOLE:{const e=a.payload.map((e=>{try{return JSON.parse(e)}catch(n){return e}}));"method"in a&&(null===(t=i[a.method])||void 0===t?void 0:t.conditionFn(h))&&console[a.method].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}}};if(window.addEventListener("message",r),p&&!k.current){let e=document.querySelector("#"+d);e||(e=document.createElement("iframe"),e.setAttribute("src",C)),o=e=>{((...e)=>{console.error("%c●%c",a,"",...e)})("Error loading Straddle Widget"),null==y||y({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},e&&e.addEventListener("error",o),e.id=d;let n=S;S||(n={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),n&&Object.assign(e.style,n),v&&v.split(" ").forEach((n=>{e.classList.add(n)})),t&&"current"in t&&t.current&&t.current instanceof Node?t.current.appendChild(e):(!t||!("current"in t)||t.current&&t.current instanceof Node||((...e)=>{console.warn("%c●%c",a,"",...e)})("ref passed to StraddleBridge is not a valid ref, reverting to appening to body. Ref passed:",t.current),document.getElementsByTagName("body")[0].appendChild(e),k.current=!0)}else p||(null===(n=document.querySelector(`#${d}`))||void 0===n||n.remove(),k.current=!1,O(!1));return()=>{const e=document.querySelector("#"+d);o&&e&&e.removeEventListener("error",o),r&&window.removeEventListener("message",r)}}),[p]),r((()=>{"undefined"!=typeof window&&(window.straddleDebug={enable:()=>N({type:e.DEBUG,enable:!0}),disable:()=>N({type:e.DEBUG,enable:!1})})}),[]),null}));u.displayName="StraddleBridge";export{u as StraddleBridge,c as useStraddleBridge};
//# sourceMappingURL=index.esm.js.map

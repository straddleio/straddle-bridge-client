import{EBridgeMessageType as e}from"@straddleio/bridge-core";import{forwardRef as t,useRef as n,useEffect as r,useState as o}from"react";const d="Straddle-widget-iframe",a={production:"https://bridge.straddle.io",sandbox:"https://bridge-sandbox.straddle.io"},l=({mode:e,appUrl:t})=>{t=null!=t?t:(e=>a[null!=e?e:"production"])(e),t=t.endsWith("/")?t.slice(0,-1):t;const[n,r]=o(!1),l=s();return{send:e=>{var n;const r=document.getElementById(d);r&&(null===(n=r.contentWindow)||void 0===n||n.postMessage(e,t))},bridgeAppMounted:n,setBridgeAppMounted:r,url:`${t}/${l}/`,appUrl:t}},s=()=>"undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),i=t(((t,o)=>{const{mode:a,open:s=!0,token:i,onSuccess:c,onSuccessCTAClicked:u,onClose:p,onLoadError:m,allowManualEntry:g=!0,onManualEntry:y,onRetry:E,className:b,style:f,verbose:w}=t,{send:v,setBridgeAppMounted:N,url:S,appUrl:h}=l({mode:a,appUrl:t.appUrl}),C=n(!1);return r((()=>{var t;let n;const r=function(t){var n;if(t.origin===h){w&&t.data.type!==e.CONSOLE&&console.log("Straddle Bridge React client, Message received from widget:",t.data.type,t);const r=t.data;switch(null==r?void 0:r.type){case e.PING:break;case e.MOUNTED:N(!0),v({type:e.INITIALIZE,token:i});break;case e.ON_CLOSE:null==p||p(),N(!1),null===(n=document.querySelector(`#${d}`))||void 0===n||n.remove();break;case e.ON_SUCCESS_CTA_CLICKED:null==u||u();break;case e.ON_PAYKEY:null==c||c(r.paykeyResponse);break;case e.ON_MANUAL_ENTRY:null==y||y();break;case e.ON_RETRY:null==E||E();break;case e.CONSOLE:{const e=r.payload.map((e=>{try{return JSON.parse(e)}catch(t){return e}}));"method"in r&&console[r.method].apply(console,e)}}}else w&&console.log("Message received from unknown origin:",t.origin,t.data)};if(window.addEventListener("message",r),s&&!C.current){let e=document.querySelector("#"+d);e||(e=document.createElement("iframe"),e.setAttribute("src",`${S}?allowManualEntry=${g}`)),n=e=>{console.error("Error loading Straddle Widget"),null==m||m(e)},e&&e.addEventListener("error",n),e.id=d;let t=f;f||(t={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),t&&Object.assign(e.style,t),b&&b.split(" ").forEach((t=>{e.classList.add(t)})),o&&"current"in o&&o.current&&o.current instanceof Node?o.current.appendChild(e):(!o||!("current"in o)||o.current&&o.current instanceof Node||console.warn("ref passed to StraddleBridge is not a valid ref, reverting to appening to body. Ref passed:",o.current),document.getElementsByTagName("body")[0].appendChild(e),C.current=!0)}else s||(null===(t=document.querySelector(`#${d}`))||void 0===t||t.remove(),C.current=!1,N(!1));return()=>{const e=document.querySelector("#"+d);n&&e&&e.removeEventListener("error",n),r&&window.removeEventListener("message",r)}}),[s]),r((()=>{"undefined"!=typeof window&&(window.straddleDebug={enable:()=>v({type:e.DEBUG,enable:!0}),disable:()=>v({type:e.DEBUG,enable:!1})})}),[]),null}));i.displayName="StraddleBridge";export{i as StraddleBridge,l as useStraddleBridge};
//# sourceMappingURL=index.esm.js.map

import{EBridgeMessageType as e}from"@straddlecom/bridge-core";import{forwardRef as n,useRef as o,useEffect as r,useState as t}from"react";const d="Straddle-widget-iframe",a="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",i={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},l=(...e)=>console.log("%c●%c",a,"",...e),s={production:"https://bridge.straddle.com",sandbox:"https://bridge-sandbox.straddle.com"},c=({mode:e,appUrl:n,allowManualEntry:o,verbose:r})=>{n=null!=n?n:(e=>s[null!=e?e:"sandbox"])(e),n=n.endsWith("/")?n.slice(0,-1):n;const[a,i]=t(!1),[c,u]=p();return{send:e=>{var o;const t=document.getElementById(d);t?(r&&l("Sending message to iframe with target:",n,", message:",e),null===(o=t.contentWindow)||void 0===o||o.postMessage(e,n)):r&&console.log("No iframe found, message not sent:",e)},bridgeAppMounted:a,setBridgeAppMounted:i,url:`${n}/?parentOriginURL=${c}&parentOriginProtocol=${u}&allowManualEntry=${o}`,appUrl:n}},p=()=>["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")],u=n(((n,t)=>{const{mode:s,open:p=!0,token:u,onSuccess:g,onSuccessCTAClicked:m,onClose:y,onLoadError:b,allowManualEntry:f=!0,onManualEntry:v,onRetry:w,className:E,style:O,verbose:S}=n,{send:h,setBridgeAppMounted:N,url:C,appUrl:k}=c({mode:s,appUrl:n.appUrl,allowManualEntry:f,verbose:S}),L=o(!1);return r((()=>{var n;let o;const r=function(n){var o,r,t,a;const s=n.data,c=Object.assign(Object.assign({},s),{type:"string"==typeof(null==s?void 0:s.type)?s.type.replace("@straddleio/","@straddlecom/"):null==s?void 0:s.type});if((null===(o=null==c?void 0:c.type)||void 0===o?void 0:o.includes("@straddlecom/"))&&n.origin!==k&&S&&l("Message received from Bridge app but from unknown origin:",n.origin,n.data),n.origin===k)switch(S&&c.type!==e.CONSOLE&&l("Message received from Bridge app:",c.type,n),c.type){case e.PING:break;case e.MOUNTED:N(!0),h({type:e.INITIALIZE,token:u});break;case e.ON_CLOSE:null==y||y(),N(!1),null===(r=document.querySelector(`#${d}`))||void 0===r||r.remove();break;case e.ON_SUCCESS_CTA_CLICKED:null==m||m(),null===(t=document.querySelector(`#${d}`))||void 0===t||t.remove();break;case e.ON_PAYKEY:null==g||g(c.paykeyResponse);break;case e.ON_MANUAL_ENTRY:null==v||v();break;case e.ON_RETRY:null==w||w();break;case e.ERROR:null==b||b(Object.assign(Object.assign({error_code:"init_error"},c.payload),{origin:n.origin}));break;case e.CONSOLE:{const e=c.payload.map((e=>{try{return JSON.parse(e)}catch(n){return e}}));"method"in c&&(null===(a=i[c.method])||void 0===a?void 0:a.conditionFn(S))&&console[c.method].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}};if(window.addEventListener("message",r),p&&!L.current){let e=document.querySelector("#"+d);e||(e=document.createElement("iframe"),e.setAttribute("src",C)),o=e=>{((...e)=>{console.error("%c●%c",a,"",...e)})("Error loading Straddle Widget"),null==b||b({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},e&&e.addEventListener("error",o),e.id=d;let n=O;O||(n={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),n&&Object.assign(e.style,n),E&&E.split(" ").forEach((n=>{e.classList.add(n)})),t&&"current"in t&&t.current&&t.current instanceof Node?t.current.appendChild(e):(!t||!("current"in t)||t.current&&t.current instanceof Node||((...e)=>{console.warn("%c●%c",a,"",...e)})("ref passed to StraddleBridge is not a valid ref, reverting to appening to body. Ref passed:",t.current),document.getElementsByTagName("body")[0].appendChild(e),L.current=!0)}else p||(null===(n=document.querySelector(`#${d}`))||void 0===n||n.remove(),L.current=!1,N(!1));return()=>{const e=document.querySelector("#"+d);o&&e&&e.removeEventListener("error",o),r&&window.removeEventListener("message",r)}}),[p]),r((()=>{"undefined"!=typeof window&&(window.straddleDebug={enable:()=>h({type:e.DEBUG,enable:!0}),disable:()=>h({type:e.DEBUG,enable:!1})})}),[]),null}));u.displayName="StraddleBridge";export{u as StraddleBridge,c as useStraddleBridge};
//# sourceMappingURL=index.esm.js.map

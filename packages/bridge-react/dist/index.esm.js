import{EBridgeMessageType as e}from"@straddlecom/bridge-core";import{forwardRef as n,useRef as o,useEffect as r,useState as t}from"react";const d="Straddle-widget-iframe",i="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",a={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},l=(...e)=>console.log("%c●%c",i,"",...e),c=(...e)=>console.warn("%c●%c",i,"",...e),s={production:"https://bridge.straddle.com",sandbox:"https://bridge-sandbox.straddle.com"},u=({mode:e,appUrl:n,allowManualEntry:o,verbose:r})=>{n=null!=n?n:(e=>s[null!=e?e:"sandbox"])(e),n=n.endsWith("/")?n.slice(0,-1):n;const[i,a]=t(!1),[c,u]=p();return{send:e=>{var o;const t=document.getElementById(d);t?(r&&l("Sending message to iframe with target:",n,", message:",e),null===(o=t.contentWindow)||void 0===o||o.postMessage(e,n)):r&&console.log("No iframe found, message not sent:",e)},bridgeAppMounted:i,setBridgeAppMounted:a,url:`${n}/?parentOriginURL=${c}&parentOriginProtocol=${u}&allowManualEntry=${o}`,appUrl:n}},p=()=>["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")],m=()=>"undefined"==typeof window?{mounted:!1,mounting:!1}:(window.__STRADDLE_BRIDGE__||(window.__STRADDLE_BRIDGE__={mounted:!1,mounting:!1}),window.__STRADDLE_BRIDGE__),g=n(((n,t)=>{const{mode:s,open:p=!0,token:g,onSuccess:w,onSuccessCTAClicked:y,onClose:b,onLoadError:E,allowManualEntry:f=!0,onManualEntry:v,onRetry:_,className:S,style:O,verbose:N}=n,{send:R,url:h,appUrl:D}=u({mode:s,appUrl:n.appUrl,allowManualEntry:f,verbose:N}),L=o(null);return r((()=>{var n;const o=m();if(p&&(o.mounting||o.mounted))return N&&c("StraddleBridge already mounted; skipping duplicate mount."),()=>{};let r;const s=function(n){var o,r,t,i;const c=n.data,s=Object.assign(Object.assign({},c),{type:"string"==typeof(null==c?void 0:c.type)?c.type.replace("@straddleio/","@straddlecom/"):null==c?void 0:c.type});if((null===(o=null==s?void 0:s.type)||void 0===o?void 0:o.includes("@straddlecom/"))&&n.origin!==D&&N&&l("Message received from Bridge app but from unknown origin:",n.origin,n.data),n.origin===D)switch(N&&s.type!==e.CONSOLE&&l("Message received from Bridge app:",s.type,n),s.type){case e.PING:break;case e.MOUNTED:R({type:e.INITIALIZE,token:g});break;case e.ON_CLOSE:null==b||b();{const e=m();e.owner&&L.current&&e.owner===L.current&&(null===(r=document.querySelector(`#${d}`))||void 0===r||r.remove(),e.mounting=!1,e.mounted=!1,e.owner=void 0)}break;case e.ON_SUCCESS_CTA_CLICKED:null==y||y();{const e=m();e.owner&&L.current&&e.owner===L.current&&(null===(t=document.querySelector(`#${d}`))||void 0===t||t.remove(),e.mounting=!1,e.mounted=!1,e.owner=void 0)}break;case e.ON_PAYKEY:null==w||w(s.paykeyResponse);break;case e.ON_MANUAL_ENTRY:null==v||v();break;case e.ON_RETRY:null==_||_();break;case e.ERROR:null==E||E(Object.assign(Object.assign({error_code:"init_error"},s.payload),{origin:n.origin}));break;case e.CONSOLE:{const e=s.payload.map((e=>{try{return JSON.parse(e)}catch(n){return e}}));"method"in s&&(null===(i=a[s.method])||void 0===i?void 0:i.conditionFn(N))&&console[s.method].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}};if(window.addEventListener("message",s),p){o.mounting=!0,L.current=Symbol("STRADDLE_BRIDGE_OWNER"),o.owner=L.current;let e=document.querySelector("#"+d);e||(e=document.createElement("iframe"),e.setAttribute("src",h)),r=e=>{((...e)=>{console.error("%c●%c",i,"",...e)})("Error loading Straddle Widget"),null==E||E({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},e&&e.addEventListener("error",r),e.id=d;let n=O;O||(n={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),n&&Object.assign(e.style,n),S&&S.split(" ").forEach((n=>{e.classList.add(n)})),t&&"current"in t&&t.current&&t.current instanceof Node?t.current.appendChild(e):(!t||!("current"in t)||t.current&&t.current instanceof Node||c("ref passed to StraddleBridge is not a valid ref, reverting to appending to body. Ref passed:",t.current),document.getElementsByTagName("body")[0].appendChild(e)),o.mounting=!1,o.mounted=!0}else if(!p){const e=m();e.owner&&L.current&&e.owner===L.current&&(null===(n=document.querySelector(`#${d}`))||void 0===n||n.remove(),e.mounting=!1,e.mounted=!1,e.owner=void 0)}return()=>{const e=document.querySelector("#"+d);r&&e&&e.removeEventListener("error",r),s&&window.removeEventListener("message",s);const n=m();n.owner&&L.current&&n.owner===L.current&&(n.mounting=!1,n.mounted=!1,n.owner=void 0)}}),[p]),r((()=>{"undefined"!=typeof window&&(window.straddleDebug={enable:()=>R({type:e.DEBUG,enable:!0}),disable:()=>R({type:e.DEBUG,enable:!1})})}),[]),null}));g.displayName="StraddleBridge";export{g as StraddleBridge,u as useStraddleBridge};
//# sourceMappingURL=index.esm.js.map

"use strict";var e=require("@straddleio/bridge-core"),r=require("react");const t="Straddle-widget-iframe",n=({appUrl:e})=>{e=e.endsWith("/")?e.slice(0,-1):e;const[n,o]=r.useState(!1),[d,a]=r.useState(!1);console.log({bridgeAppMounted:d});const i=s();return{send:r=>{var n;const s=document.getElementById(t);s&&(null===(n=s.contentWindow)||void 0===n||n.postMessage(r,e))},iframeMounted:n,setIframeMounted:o,bridgeAppMounted:d,setBridgeAppMounted:a,url:`${e}/${i}/`}},s=()=>"undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),o=r.forwardRef(((s,o)=>{const{appUrl:d,open:a=!0,token:i,onSuccess:l,onSuccessCTAClicked:c,onClose:u,onLoadError:p,allowManualEntry:g=!0,onManualEntry:E,onRetry:y,className:m,style:f,verbose:M}=s,{send:B,setIframeMounted:S,bridgeAppMounted:b,setBridgeAppMounted:w,url:v}=n({appUrl:d}),T=r.useRef(!1);return r.useEffect((()=>{var r;let n,s;if(a){let r=document.querySelector("#"+t);r||(r=document.createElement("iframe"),r.setAttribute("src",v)),n=e=>{console.error("Error loading Straddle Widget"),null==p||p(e)},r&&r.addEventListener("error",n),r.id=t;let a=f;f||(a={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),a&&Object.assign(r.style,a),m&&m.split(" ").forEach((e=>{r.classList.add(e)})),o&&"current"in o&&o.current&&o.current instanceof Node?o.current.appendChild(r):(!o||!("current"in o)||o.current&&o.current instanceof Node||console.warn("ref passed to StraddleBridge is not a valid ref, reverting to appening to body. Ref passed:",o.current),document.getElementsByTagName("body")[0].appendChild(r)),s=function(r){var n;if(r.origin===d){M&&r.data.type!==e.EBridgeMessageType.CONSOLE&&console.log("Straddle Bridge React client, Message received from widget:",r.data.type,r);const s=r.data;switch(null==s?void 0:s.type){case e.EBridgeMessageType.PING:break;case e.EBridgeMessageType.MOUNTED:w(!0),console.log("HERE, sending initialize",g),B({type:e.EBridgeMessageType.INITIALIZE,token:i,allowManualEntry:g});break;case e.EBridgeMessageType.ON_CLOSE:null==u||u(),w(!1),null===(n=document.querySelector(`#${t}`))||void 0===n||n.remove();break;case e.EBridgeMessageType.ON_SUCCESS_CTA_CLICKED:null==c||c();break;case e.EBridgeMessageType.ON_PAYKEY:null==l||l(s.paykeyResponse);break;case e.EBridgeMessageType.ON_MANUAL_ENTRY:null==E||E();break;case e.EBridgeMessageType.ON_RETRY:null==y||y();break;case e.EBridgeMessageType.CONSOLE:{const e=s.payload.map((e=>{try{return JSON.parse(e)}catch(r){return e}}));"method"in s&&console[s.method].apply(console,e)}}}},window.addEventListener("message",s)}else!a&&T&&(null===(r=document.querySelector(`#${t}`))||void 0===r||r.remove(),S(!1),T.current=!1,w(!1));return()=>{const e=document.querySelector("#"+t);n&&e&&e.removeEventListener("error",n),s&&window.removeEventListener("message",s)}}),[a]),r.useEffect((()=>{"undefined"!=typeof window&&(window.straddleDebug={enable:()=>B({type:e.EBridgeMessageType.DEBUG,enable:!0}),disable:()=>B({type:e.EBridgeMessageType.DEBUG,enable:!1})})}),[]),null}));o.displayName="StraddleBridge",exports.StraddleBridge=o,exports.useStraddleBridge=n;
//# sourceMappingURL=index.js.map

"use strict";var e=require("@straddleio/bridge-core"),r=require("react");const t="Straddle-widget-iframe",n={production:"https://bridge.straddle.io",sandbox:"https://bridge-sandbox.straddle.io"},o=({mode:e,appUrl:o})=>{o=null!=o?o:(e=>n[null!=e?e:"production"])(e),o=o.endsWith("/")?o.slice(0,-1):o;const[s,a]=r.useState(!1),i=d();return{send:e=>{var r;const n=document.getElementById(t);n&&(null===(r=n.contentWindow)||void 0===r||r.postMessage(e,o))},bridgeAppMounted:s,setBridgeAppMounted:a,url:`${o}/${i}/`,appUrl:o}},d=()=>"undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),s=r.forwardRef(((n,d)=>{const{mode:s,open:a=!0,token:i,onSuccess:l,onSuccessCTAClicked:c,onClose:p,onLoadError:u,allowManualEntry:g=!0,onManualEntry:y,onRetry:E,className:m,style:f,verbose:b}=n,{send:B,setBridgeAppMounted:M,url:w,appUrl:v}=o({mode:s,appUrl:n.appUrl}),S=r.useRef(!1);return r.useEffect((()=>{var r;let n;const o=function(r){var n;if(r.origin===v){b&&r.data.type!==e.EBridgeMessageType.CONSOLE&&console.log("Straddle Bridge React client, Message received from widget:",r.data.type,r);const o=r.data;switch(null==o?void 0:o.type){case e.EBridgeMessageType.PING:break;case e.EBridgeMessageType.MOUNTED:M(!0),B({type:e.EBridgeMessageType.INITIALIZE,token:i});break;case e.EBridgeMessageType.ON_CLOSE:null==p||p(),M(!1),null===(n=document.querySelector(`#${t}`))||void 0===n||n.remove();break;case e.EBridgeMessageType.ON_SUCCESS_CTA_CLICKED:null==c||c();break;case e.EBridgeMessageType.ON_PAYKEY:null==l||l(o.paykeyResponse);break;case e.EBridgeMessageType.ON_MANUAL_ENTRY:null==y||y();break;case e.EBridgeMessageType.ON_RETRY:null==E||E();break;case e.EBridgeMessageType.CONSOLE:{const e=o.payload.map((e=>{try{return JSON.parse(e)}catch(r){return e}}));"method"in o&&console[o.method].apply(console,e)}}}else b&&console.log("Message received from unknown origin:",r.origin,r.data)};if(window.addEventListener("message",o),a&&!S.current){let e=document.querySelector("#"+t);e||(e=document.createElement("iframe"),e.setAttribute("src",`${w}?allowManualEntry=${g}`)),n=e=>{console.error("Error loading Straddle Widget"),null==u||u(e)},e&&e.addEventListener("error",n),e.id=t;let r=f;f||(r={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),r&&Object.assign(e.style,r),m&&m.split(" ").forEach((r=>{e.classList.add(r)})),d&&"current"in d&&d.current&&d.current instanceof Node?d.current.appendChild(e):(!d||!("current"in d)||d.current&&d.current instanceof Node||console.warn("ref passed to StraddleBridge is not a valid ref, reverting to appening to body. Ref passed:",d.current),document.getElementsByTagName("body")[0].appendChild(e),S.current=!0)}else a||(null===(r=document.querySelector(`#${t}`))||void 0===r||r.remove(),S.current=!1,M(!1));return()=>{const e=document.querySelector("#"+t);n&&e&&e.removeEventListener("error",n),o&&window.removeEventListener("message",o)}}),[a]),r.useEffect((()=>{"undefined"!=typeof window&&(window.straddleDebug={enable:()=>B({type:e.EBridgeMessageType.DEBUG,enable:!0}),disable:()=>B({type:e.EBridgeMessageType.DEBUG,enable:!1})})}),[]),null}));s.displayName="StraddleBridge",exports.StraddleBridge=s,exports.useStraddleBridge=o;
//# sourceMappingURL=index.js.map

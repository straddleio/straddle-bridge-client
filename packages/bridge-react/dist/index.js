"use strict";var e=require("@straddlecom/bridge-core"),r=require("react");const n="Straddle-widget-iframe",o="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",t={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},d=(...e)=>console.log("%c●%c",o,"",...e),a={production:"https://bridge.straddle.com",sandbox:"https://bridge-sandbox.straddle.com"},i=({mode:e,appUrl:o,allowManualEntry:t,verbose:i})=>{o=null!=o?o:(e=>a[null!=e?e:"production"])(e),o=o.endsWith("/")?o.slice(0,-1):o;const[l,c]=r.useState(!1),[p,g]=s();return{send:e=>{var r;const t=document.getElementById(n);t?(i&&d("Sending message to iframe with target:",o,", message:",e),null===(r=t.contentWindow)||void 0===r||r.postMessage(e,o)):i&&console.log("No iframe found, message not sent:",e)},bridgeAppMounted:l,setBridgeAppMounted:c,url:`${o}/?parentOriginURL=${p}&parentOriginProtocol=${g}&allowManualEntry=${t}`,appUrl:o}},s=()=>["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")],l=r.forwardRef(((a,s)=>{const{mode:l,open:c=!0,token:p,onSuccess:g,onSuccessCTAClicked:u,onClose:y,onLoadError:m,allowManualEntry:E=!0,onManualEntry:f,onRetry:b,className:v,style:w,verbose:M}=a,{send:B,setBridgeAppMounted:S,url:O,appUrl:T}=i({mode:l,appUrl:a.appUrl,allowManualEntry:E,verbose:M}),h=r.useRef(!1);return r.useEffect((()=>{var r;let a;const i=function(r){var o,a,i,s;const l=r.data,c=Object.assign(Object.assign({},l),{type:"string"==typeof(null==l?void 0:l.type)?l.type.replace("@straddleio/","@straddlecom/"):null==l?void 0:l.type});if((null===(o=null==c?void 0:c.type)||void 0===o?void 0:o.includes("@straddlecom/"))&&r.origin!==T&&M&&d("Message received from Bridge app but from unknown origin:",r.origin,r.data),r.origin===T)switch(M&&c.type!==e.EBridgeMessageType.CONSOLE&&d("Message received from Bridge app:",c.type,r),c.type){case e.EBridgeMessageType.PING:break;case e.EBridgeMessageType.MOUNTED:S(!0),B({type:e.EBridgeMessageType.INITIALIZE,token:p});break;case e.EBridgeMessageType.ON_CLOSE:null==y||y(),S(!1),null===(a=document.querySelector(`#${n}`))||void 0===a||a.remove();break;case e.EBridgeMessageType.ON_SUCCESS_CTA_CLICKED:null==u||u(),null===(i=document.querySelector(`#${n}`))||void 0===i||i.remove();break;case e.EBridgeMessageType.ON_PAYKEY:null==g||g(c.paykeyResponse);break;case e.EBridgeMessageType.ON_MANUAL_ENTRY:null==f||f();break;case e.EBridgeMessageType.ON_RETRY:null==b||b();break;case e.EBridgeMessageType.ERROR:null==m||m(Object.assign(Object.assign({error_code:"init_error"},c.payload),{origin:r.origin}));break;case e.EBridgeMessageType.CONSOLE:{const e=c.payload.map((e=>{try{return JSON.parse(e)}catch(r){return e}}));"method"in c&&(null===(s=t[c.method])||void 0===s?void 0:s.conditionFn(M))&&console[c.method].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}};if(window.addEventListener("message",i),c&&!h.current){let e=document.querySelector("#"+n);e||(e=document.createElement("iframe"),e.setAttribute("src",O)),a=e=>{((...e)=>{console.error("%c●%c",o,"",...e)})("Error loading Straddle Widget"),null==m||m({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},e&&e.addEventListener("error",a),e.id=n;let r=w;w||(r={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),r&&Object.assign(e.style,r),v&&v.split(" ").forEach((r=>{e.classList.add(r)})),s&&"current"in s&&s.current&&s.current instanceof Node?s.current.appendChild(e):(!s||!("current"in s)||s.current&&s.current instanceof Node||((...e)=>{console.warn("%c●%c",o,"",...e)})("ref passed to StraddleBridge is not a valid ref, reverting to appening to body. Ref passed:",s.current),document.getElementsByTagName("body")[0].appendChild(e),h.current=!0)}else c||(null===(r=document.querySelector(`#${n}`))||void 0===r||r.remove(),h.current=!1,S(!1));return()=>{const e=document.querySelector("#"+n);a&&e&&e.removeEventListener("error",a),i&&window.removeEventListener("message",i)}}),[c]),r.useEffect((()=>{"undefined"!=typeof window&&(window.straddleDebug={enable:()=>B({type:e.EBridgeMessageType.DEBUG,enable:!0}),disable:()=>B({type:e.EBridgeMessageType.DEBUG,enable:!1})})}),[]),null}));l.displayName="StraddleBridge",exports.StraddleBridge=l,exports.useStraddleBridge=i;
//# sourceMappingURL=index.js.map

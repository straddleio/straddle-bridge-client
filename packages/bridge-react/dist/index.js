"use strict";var e=require("@straddlecom/bridge-core"),r=require("react");const n="Straddle-widget-iframe",o="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",t={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},d=(...e)=>console.log("%c●%c",o,"",...e),a={production:"https://bridge.straddle.io",sandbox:"https://bridge-sandbox.straddle.io"},s=({mode:e,appUrl:o,allowManualEntry:t,verbose:s})=>{o=null!=o?o:(e=>a[null!=e?e:"production"])(e),o=o.endsWith("/")?o.slice(0,-1):o;const[l,c]=r.useState(!1),[p,u]=i();return{send:e=>{var r;const t=document.getElementById(n);t?(s&&d("Sending message to iframe with target:",o,", message:",e),null===(r=t.contentWindow)||void 0===r||r.postMessage(e,o)):s&&console.log("No iframe found, message not sent:",e)},bridgeAppMounted:l,setBridgeAppMounted:c,url:`${o}/?parentOriginURL=${p}&parentOriginProtocol=${u}&allowManualEntry=${t}`,appUrl:o}},i=()=>["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")],l=r.forwardRef(((a,i)=>{const{mode:l,open:c=!0,token:p,onSuccess:u,onSuccessCTAClicked:g,onClose:y,onLoadError:E,allowManualEntry:m=!0,onManualEntry:f,onRetry:b,className:w,style:v,verbose:M}=a,{send:B,setBridgeAppMounted:S,url:T,appUrl:h}=s({mode:l,appUrl:a.appUrl,allowManualEntry:m,verbose:M}),N=r.useRef(!1);return r.useEffect((()=>{var r;let a;const s=function(r){var o,a,s;if(r.origin===h){M&&r.data.type!==e.EBridgeMessageType.CONSOLE&&d("Message received from Bridge app:",r.data.type,r);const i=r.data;switch(null==i?void 0:i.type){case e.EBridgeMessageType.PING:break;case e.EBridgeMessageType.MOUNTED:S(!0),B({type:e.EBridgeMessageType.INITIALIZE,token:p});break;case e.EBridgeMessageType.ON_CLOSE:null==y||y(),S(!1),null===(o=document.querySelector(`#${n}`))||void 0===o||o.remove();break;case e.EBridgeMessageType.ON_SUCCESS_CTA_CLICKED:null==g||g(),null===(a=document.querySelector(`#${n}`))||void 0===a||a.remove();break;case e.EBridgeMessageType.ON_PAYKEY:null==u||u(i.paykeyResponse);break;case e.EBridgeMessageType.ON_MANUAL_ENTRY:null==f||f();break;case e.EBridgeMessageType.ON_RETRY:null==b||b();break;case e.EBridgeMessageType.ERROR:null==E||E(Object.assign(Object.assign({error_code:"init_error"},i.payload),{origin:r.origin}));break;case e.EBridgeMessageType.CONSOLE:{const e=i.payload.map((e=>{try{return JSON.parse(e)}catch(r){return e}}));"method"in i&&(null===(s=t[i.method])||void 0===s?void 0:s.conditionFn(M))&&console[i.method].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}}};if(window.addEventListener("message",s),c&&!N.current){let e=document.querySelector("#"+n);e||(e=document.createElement("iframe"),e.setAttribute("src",T)),a=e=>{((...e)=>{console.error("%c●%c",o,"",...e)})("Error loading Straddle Widget"),null==E||E({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},e&&e.addEventListener("error",a),e.id=n;let r=v;v||(r={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),r&&Object.assign(e.style,r),w&&w.split(" ").forEach((r=>{e.classList.add(r)})),i&&"current"in i&&i.current&&i.current instanceof Node?i.current.appendChild(e):(!i||!("current"in i)||i.current&&i.current instanceof Node||((...e)=>{console.warn("%c●%c",o,"",...e)})("ref passed to StraddleBridge is not a valid ref, reverting to appening to body. Ref passed:",i.current),document.getElementsByTagName("body")[0].appendChild(e),N.current=!0)}else c||(null===(r=document.querySelector(`#${n}`))||void 0===r||r.remove(),N.current=!1,S(!1));return()=>{const e=document.querySelector("#"+n);a&&e&&e.removeEventListener("error",a),s&&window.removeEventListener("message",s)}}),[c]),r.useEffect((()=>{"undefined"!=typeof window&&(window.straddleDebug={enable:()=>B({type:e.EBridgeMessageType.DEBUG,enable:!0}),disable:()=>B({type:e.EBridgeMessageType.DEBUG,enable:!1})})}),[]),null}));l.displayName="StraddleBridge",exports.StraddleBridge=l,exports.useStraddleBridge=s;
//# sourceMappingURL=index.js.map

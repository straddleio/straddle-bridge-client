"use strict";var e=require("@straddlecom/bridge-core"),n=require("react");const r="Straddle-widget-iframe",o="color: #14b8a6; padding: 0px; border-radius: 24px; font-weight: 600;",t={log:{conditionFn:e=>e},error:{conditionFn:e=>!0},warn:{conditionFn:e=>!0},info:{conditionFn:e=>e},debug:{conditionFn:e=>e},table:{conditionFn:e=>e}},d=(...e)=>console.log("%c●%c",o,"",...e),i=(...e)=>console.warn("%c●%c",o,"",...e),a={production:"https://bridge.straddle.com",sandbox:"https://bridge-sandbox.straddle.com"},s=({mode:e,appUrl:o,allowManualEntry:t,verbose:i})=>{o=null!=o?o:(e=>a[null!=e?e:"sandbox"])(e),o=o.endsWith("/")?o.slice(0,-1):o;const[s,c]=n.useState(!1),[u,g]=l();return{send:e=>{var n;const t=document.getElementById(r);t?(i&&d("Sending message to iframe with target:",o,", message:",e),null===(n=t.contentWindow)||void 0===n||n.postMessage(e,o)):i&&console.log("No iframe found, message not sent:",e)},bridgeAppMounted:s,setBridgeAppMounted:c,url:`${o}/?parentOriginURL=${u}&parentOriginProtocol=${g}&allowManualEntry=${t}`,appUrl:o}},l=()=>["undefined"!=typeof window&&encodeURIComponent(window.location.origin.replace("https://","").replace("http://","")),"undefined"!=typeof window&&window.location.protocol.replace(":","")],c=()=>"undefined"==typeof window?{mounted:!1,mounting:!1}:(window.__STRADDLE_BRIDGE__||(window.__STRADDLE_BRIDGE__={mounted:!1,mounting:!1}),window.__STRADDLE_BRIDGE__),u=n.forwardRef(((a,l)=>{const{mode:u,open:g=!0,token:p,onSuccess:m,onSuccessCTAClicked:y,onClose:E,onLoadError:w,allowManualEntry:f=!0,onManualEntry:b,onRetry:v,className:B,style:S,verbose:_}=a,{send:M,url:T,appUrl:R}=s({mode:u,appUrl:a.appUrl,allowManualEntry:f,verbose:_}),O=n.useRef(null);return n.useEffect((()=>{var n;const a=c();if(g&&(a.mounting||a.mounted))return _&&i("StraddleBridge already mounted; skipping duplicate mount."),()=>{};let s;const u=function(n){var o,i,a,s;const l=n.data,u=Object.assign(Object.assign({},l),{type:"string"==typeof(null==l?void 0:l.type)?l.type.replace("@straddleio/","@straddlecom/"):null==l?void 0:l.type});if((null===(o=null==u?void 0:u.type)||void 0===o?void 0:o.includes("@straddlecom/"))&&n.origin!==R&&_&&d("Message received from Bridge app but from unknown origin:",n.origin,n.data),n.origin===R)switch(_&&u.type!==e.EBridgeMessageType.CONSOLE&&d("Message received from Bridge app:",u.type,n),u.type){case e.EBridgeMessageType.PING:break;case e.EBridgeMessageType.MOUNTED:M({type:e.EBridgeMessageType.INITIALIZE,token:p});break;case e.EBridgeMessageType.ON_CLOSE:null==E||E();{const e=c();e.owner&&O.current&&e.owner===O.current&&(null===(i=document.querySelector(`#${r}`))||void 0===i||i.remove(),e.mounting=!1,e.mounted=!1,e.owner=void 0)}break;case e.EBridgeMessageType.ON_SUCCESS_CTA_CLICKED:null==y||y();{const e=c();e.owner&&O.current&&e.owner===O.current&&(null===(a=document.querySelector(`#${r}`))||void 0===a||a.remove(),e.mounting=!1,e.mounted=!1,e.owner=void 0)}break;case e.EBridgeMessageType.ON_PAYKEY:null==m||m(u.paykeyResponse);break;case e.EBridgeMessageType.ON_MANUAL_ENTRY:null==b||b();break;case e.EBridgeMessageType.ON_RETRY:null==v||v();break;case e.EBridgeMessageType.ERROR:null==w||w(Object.assign(Object.assign({error_code:"init_error"},u.payload),{origin:n.origin}));break;case e.EBridgeMessageType.CONSOLE:{const e=u.payload.map((e=>{try{return JSON.parse(e)}catch(n){return e}}));"method"in u&&(null===(s=t[u.method])||void 0===s?void 0:s.conditionFn(_))&&console[u.method].apply(console,["%c●%c","color: #a855f7; padding: 0px; border-radius: 24px; font-weight: 600;","",...e])}}};if(window.addEventListener("message",u),g){a.mounting=!0,O.current=Symbol("STRADDLE_BRIDGE_OWNER"),a.owner=O.current;let e=document.querySelector("#"+r);e||(e=document.createElement("iframe"),e.setAttribute("src",T)),s=e=>{((...e)=>{console.error("%c●%c",o,"",...e)})("Error loading Straddle Widget"),null==w||w({error_code:"iframe_error",error:e,message:"Error loading Straddle Widget"})},e&&e.addEventListener("error",s),e.id=r;let n=S;S||(n={position:"fixed",width:"100%",height:"100%",top:"0%",left:"0",zIndex:"2147483647"}),n&&Object.assign(e.style,n),B&&B.split(" ").forEach((n=>{e.classList.add(n)})),l&&"current"in l&&l.current&&l.current instanceof Node?l.current.appendChild(e):(!l||!("current"in l)||l.current&&l.current instanceof Node||i("ref passed to StraddleBridge is not a valid ref, reverting to appending to body. Ref passed:",l.current),document.getElementsByTagName("body")[0].appendChild(e)),a.mounting=!1,a.mounted=!0}else if(!g){const e=c();e.owner&&O.current&&e.owner===O.current&&(null===(n=document.querySelector(`#${r}`))||void 0===n||n.remove(),e.mounting=!1,e.mounted=!1,e.owner=void 0)}return()=>{const e=document.querySelector("#"+r);s&&e&&e.removeEventListener("error",s),u&&window.removeEventListener("message",u);const n=c();n.owner&&O.current&&n.owner===O.current&&(n.mounting=!1,n.mounted=!1,n.owner=void 0)}}),[g]),n.useEffect((()=>{"undefined"!=typeof window&&(window.straddleDebug={enable:()=>M({type:e.EBridgeMessageType.DEBUG,enable:!0}),disable:()=>M({type:e.EBridgeMessageType.DEBUG,enable:!1})})}),[]),null}));u.displayName="StraddleBridge",exports.StraddleBridge=u,exports.useStraddleBridge=s;
//# sourceMappingURL=index.js.map
